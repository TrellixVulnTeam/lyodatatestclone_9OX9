{"ast":null,"code":"var generateIV = require('../help/generate_iv');\n\nvar base64url = require('../help/base64url');\n\nmodule.exports = function (JWA, JWK) {\n  ['A128GCMKW', 'A192GCMKW', 'A256GCMKW'].forEach(function (jwaAlg) {\n    var encAlg = jwaAlg.substr(0, 7);\n    var size = parseInt(jwaAlg.substr(1, 3), 10);\n    var encrypt = JWA.encrypt.get(encAlg);\n    var decrypt = JWA.decrypt.get(encAlg);\n\n    if (encrypt && decrypt) {\n      JWA.keyManagementEncrypt.set(jwaAlg, function (key, payload) {\n        var iv = generateIV(jwaAlg);\n\n        var _encrypt = encrypt(key, payload, {\n          iv: iv\n        }),\n            ciphertext = _encrypt.ciphertext,\n            tag = _encrypt.tag;\n\n        return {\n          wrapped: ciphertext,\n          header: {\n            tag: base64url.encodeBuffer(tag),\n            iv: base64url.encodeBuffer(iv)\n          }\n        };\n      });\n      JWA.keyManagementDecrypt.set(jwaAlg, decrypt);\n\n      JWK.oct.wrapKey[jwaAlg] = JWK.oct.unwrapKey[jwaAlg] = function (key) {\n        return (key.use === 'enc' || key.use === undefined) && key.length === size;\n      };\n    }\n  });\n};","map":{"version":3,"sources":["/Users/suryanandsunil/Desktop/proto1-arizon/lyo-test/node_modules/jose/lib/jwa/aes_gcm_kw.js"],"names":["generateIV","require","base64url","module","exports","JWA","JWK","forEach","jwaAlg","encAlg","substr","size","parseInt","encrypt","get","decrypt","keyManagementEncrypt","set","key","payload","iv","ciphertext","tag","wrapped","header","encodeBuffer","keyManagementDecrypt","oct","wrapKey","unwrapKey","use","undefined","length"],"mappings":"AAAA,IAAMA,UAAU,GAAGC,OAAO,CAAC,qBAAD,CAA1B;;AACA,IAAMC,SAAS,GAAGD,OAAO,CAAC,mBAAD,CAAzB;;AAEAE,MAAM,CAACC,OAAP,GAAiB,UAACC,GAAD,EAAMC,GAAN,EAAc;AAC7B,GAAC,WAAD,EAAc,WAAd,EAA2B,WAA3B,EAAwCC,OAAxC,CAAgD,UAACC,MAAD,EAAY;AAC1D,QAAMC,MAAM,GAAGD,MAAM,CAACE,MAAP,CAAc,CAAd,EAAiB,CAAjB,CAAf;AACA,QAAMC,IAAI,GAAGC,QAAQ,CAACJ,MAAM,CAACE,MAAP,CAAc,CAAd,EAAiB,CAAjB,CAAD,EAAsB,EAAtB,CAArB;AACA,QAAMG,OAAO,GAAGR,GAAG,CAACQ,OAAJ,CAAYC,GAAZ,CAAgBL,MAAhB,CAAhB;AACA,QAAMM,OAAO,GAAGV,GAAG,CAACU,OAAJ,CAAYD,GAAZ,CAAgBL,MAAhB,CAAhB;;AAEA,QAAII,OAAO,IAAIE,OAAf,EAAwB;AACtBV,MAAAA,GAAG,CAACW,oBAAJ,CAAyBC,GAAzB,CAA6BT,MAA7B,EAAqC,UAACU,GAAD,EAAMC,OAAN,EAAkB;AACrD,YAAMC,EAAE,GAAGpB,UAAU,CAACQ,MAAD,CAArB;;AADqD,uBAEzBK,OAAO,CAACK,GAAD,EAAMC,OAAN,EAAe;AAAEC,UAAAA,EAAE,EAAFA;AAAF,SAAf,CAFkB;AAAA,YAE7CC,UAF6C,YAE7CA,UAF6C;AAAA,YAEjCC,GAFiC,YAEjCA,GAFiC;;AAGrD,eAAO;AACLC,UAAAA,OAAO,EAAEF,UADJ;AAELG,UAAAA,MAAM,EAAE;AAAEF,YAAAA,GAAG,EAAEpB,SAAS,CAACuB,YAAV,CAAuBH,GAAvB,CAAP;AAAoCF,YAAAA,EAAE,EAAElB,SAAS,CAACuB,YAAV,CAAuBL,EAAvB;AAAxC;AAFH,SAAP;AAID,OAPD;AAQAf,MAAAA,GAAG,CAACqB,oBAAJ,CAAyBT,GAAzB,CAA6BT,MAA7B,EAAqCO,OAArC;;AACAT,MAAAA,GAAG,CAACqB,GAAJ,CAAQC,OAAR,CAAgBpB,MAAhB,IAA0BF,GAAG,CAACqB,GAAJ,CAAQE,SAAR,CAAkBrB,MAAlB,IAA4B,UAAAU,GAAG;AAAA,eAAI,CAACA,GAAG,CAACY,GAAJ,KAAY,KAAZ,IAAqBZ,GAAG,CAACY,GAAJ,KAAYC,SAAlC,KAAgDb,GAAG,CAACc,MAAJ,KAAerB,IAAnE;AAAA,OAAzD;AACD;AACF,GAlBD;AAmBD,CApBD","sourcesContent":["const generateIV = require('../help/generate_iv')\nconst base64url = require('../help/base64url')\n\nmodule.exports = (JWA, JWK) => {\n  ['A128GCMKW', 'A192GCMKW', 'A256GCMKW'].forEach((jwaAlg) => {\n    const encAlg = jwaAlg.substr(0, 7)\n    const size = parseInt(jwaAlg.substr(1, 3), 10)\n    const encrypt = JWA.encrypt.get(encAlg)\n    const decrypt = JWA.decrypt.get(encAlg)\n\n    if (encrypt && decrypt) {\n      JWA.keyManagementEncrypt.set(jwaAlg, (key, payload) => {\n        const iv = generateIV(jwaAlg)\n        const { ciphertext, tag } = encrypt(key, payload, { iv })\n        return {\n          wrapped: ciphertext,\n          header: { tag: base64url.encodeBuffer(tag), iv: base64url.encodeBuffer(iv) }\n        }\n      })\n      JWA.keyManagementDecrypt.set(jwaAlg, decrypt)\n      JWK.oct.wrapKey[jwaAlg] = JWK.oct.unwrapKey[jwaAlg] = key => (key.use === 'enc' || key.use === undefined) && key.length === size\n    }\n  })\n}\n"]},"metadata":{},"sourceType":"script"}