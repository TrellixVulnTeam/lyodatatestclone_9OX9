{"ast":null,"code":"var _require = require('../errors'),\n    JWKKeySupport = _require.JWKKeySupport,\n    JOSENotSupported = _require.JOSENotSupported;\n\nvar _require2 = require('../help/consts'),\n    KEY_MANAGEMENT_ENCRYPT = _require2.KEY_MANAGEMENT_ENCRYPT,\n    KEY_MANAGEMENT_DECRYPT = _require2.KEY_MANAGEMENT_DECRYPT;\n\nvar _require3 = require('../registry'),\n    JWA = _require3.JWA,\n    JWK = _require3.JWK; // sign, verify\n\n\nrequire('./hmac')(JWA, JWK);\n\nrequire('./ecdsa')(JWA, JWK);\n\nrequire('./eddsa')(JWA, JWK);\n\nrequire('./rsassa_pss')(JWA, JWK);\n\nrequire('./rsassa')(JWA, JWK);\n\nrequire('./none')(JWA); // encrypt, decrypt\n\n\nrequire('./aes_cbc_hmac_sha2')(JWA, JWK);\n\nrequire('./aes_gcm')(JWA, JWK); // wrapKey, unwrapKey\n\n\nrequire('./rsaes')(JWA, JWK);\n\nrequire('./aes_kw')(JWA, JWK);\n\nrequire('./aes_gcm_kw')(JWA, JWK); // deriveKey\n\n\nrequire('./pbes2')(JWA, JWK);\n\nrequire('./ecdh/dir')(JWA, JWK);\n\nrequire('./ecdh/kw')(JWA, JWK);\n\nvar check = function check(key, op, alg) {\n  var cache = \"_\".concat(op, \"_\").concat(alg);\n  var label;\n  var keyOp;\n\n  if (op === 'keyManagementEncrypt') {\n    label = 'key management (encryption)';\n    keyOp = KEY_MANAGEMENT_ENCRYPT;\n  } else if (op === 'keyManagementDecrypt') {\n    label = 'key management (decryption)';\n    keyOp = KEY_MANAGEMENT_DECRYPT;\n  }\n\n  if (cache in key) {\n    if (key[cache]) {\n      return;\n    }\n\n    throw new JWKKeySupport(\"the key does not support \".concat(alg, \" \").concat(label || op, \" algorithm\"));\n  }\n\n  var value = true;\n\n  if (!JWA[op].has(alg)) {\n    throw new JOSENotSupported(\"unsupported \".concat(label || op, \" alg: \").concat(alg));\n  } else if (!key.algorithms(keyOp).has(alg)) {\n    value = false;\n  }\n\n  Object.defineProperty(key, cache, {\n    value: value,\n    enumerable: false\n  });\n\n  if (!value) {\n    return check(key, op, alg);\n  }\n};\n\nmodule.exports = {\n  check: check,\n  sign: function sign(alg, key, payload) {\n    check(key, 'sign', alg);\n    return JWA.sign.get(alg)(key, payload);\n  },\n  verify: function verify(alg, key, payload, signature) {\n    check(key, 'verify', alg);\n    return JWA.verify.get(alg)(key, payload, signature);\n  },\n  keyManagementEncrypt: function keyManagementEncrypt(alg, key, payload, opts) {\n    check(key, 'keyManagementEncrypt', alg);\n    return JWA.keyManagementEncrypt.get(alg)(key, payload, opts);\n  },\n  keyManagementDecrypt: function keyManagementDecrypt(alg, key, payload, opts) {\n    check(key, 'keyManagementDecrypt', alg);\n    return JWA.keyManagementDecrypt.get(alg)(key, payload, opts);\n  },\n  encrypt: function encrypt(alg, key, cleartext, opts) {\n    check(key, 'encrypt', alg);\n    return JWA.encrypt.get(alg)(key, cleartext, opts);\n  },\n  decrypt: function decrypt(alg, key, ciphertext, opts) {\n    check(key, 'decrypt', alg);\n    return JWA.decrypt.get(alg)(key, ciphertext, opts);\n  }\n};","map":{"version":3,"sources":["/Users/suryanandsunil/Desktop/proto1-arizon/lyo-test/node_modules/jose/lib/jwa/index.js"],"names":["require","JWKKeySupport","JOSENotSupported","KEY_MANAGEMENT_ENCRYPT","KEY_MANAGEMENT_DECRYPT","JWA","JWK","check","key","op","alg","cache","label","keyOp","value","has","algorithms","Object","defineProperty","enumerable","module","exports","sign","payload","get","verify","signature","keyManagementEncrypt","opts","keyManagementDecrypt","encrypt","cleartext","decrypt","ciphertext"],"mappings":"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","sourcesContent":["const { JWKKeySupport, JOSENotSupported } = require('../errors')\nconst { KEY_MANAGEMENT_ENCRYPT, KEY_MANAGEMENT_DECRYPT } = require('../help/consts')\n\nconst { JWA, JWK } = require('../registry')\n\n// sign, verify\nrequire('./hmac')(JWA, JWK)\nrequire('./ecdsa')(JWA, JWK)\nrequire('./eddsa')(JWA, JWK)\nrequire('./rsassa_pss')(JWA, JWK)\nrequire('./rsassa')(JWA, JWK)\nrequire('./none')(JWA)\n\n// encrypt, decrypt\nrequire('./aes_cbc_hmac_sha2')(JWA, JWK)\nrequire('./aes_gcm')(JWA, JWK)\n\n// wrapKey, unwrapKey\nrequire('./rsaes')(JWA, JWK)\nrequire('./aes_kw')(JWA, JWK)\nrequire('./aes_gcm_kw')(JWA, JWK)\n\n// deriveKey\nrequire('./pbes2')(JWA, JWK)\nrequire('./ecdh/dir')(JWA, JWK)\nrequire('./ecdh/kw')(JWA, JWK)\n\nconst check = (key, op, alg) => {\n  const cache = `_${op}_${alg}`\n\n  let label\n  let keyOp\n  if (op === 'keyManagementEncrypt') {\n    label = 'key management (encryption)'\n    keyOp = KEY_MANAGEMENT_ENCRYPT\n  } else if (op === 'keyManagementDecrypt') {\n    label = 'key management (decryption)'\n    keyOp = KEY_MANAGEMENT_DECRYPT\n  }\n\n  if (cache in key) {\n    if (key[cache]) {\n      return\n    }\n    throw new JWKKeySupport(`the key does not support ${alg} ${label || op} algorithm`)\n  }\n\n  let value = true\n  if (!JWA[op].has(alg)) {\n    throw new JOSENotSupported(`unsupported ${label || op} alg: ${alg}`)\n  } else if (!key.algorithms(keyOp).has(alg)) {\n    value = false\n  }\n\n  Object.defineProperty(key, cache, { value, enumerable: false })\n\n  if (!value) {\n    return check(key, op, alg)\n  }\n}\n\nmodule.exports = {\n  check,\n  sign: (alg, key, payload) => {\n    check(key, 'sign', alg)\n    return JWA.sign.get(alg)(key, payload)\n  },\n  verify: (alg, key, payload, signature) => {\n    check(key, 'verify', alg)\n    return JWA.verify.get(alg)(key, payload, signature)\n  },\n  keyManagementEncrypt: (alg, key, payload, opts) => {\n    check(key, 'keyManagementEncrypt', alg)\n    return JWA.keyManagementEncrypt.get(alg)(key, payload, opts)\n  },\n  keyManagementDecrypt: (alg, key, payload, opts) => {\n    check(key, 'keyManagementDecrypt', alg)\n    return JWA.keyManagementDecrypt.get(alg)(key, payload, opts)\n  },\n  encrypt: (alg, key, cleartext, opts) => {\n    check(key, 'encrypt', alg)\n    return JWA.encrypt.get(alg)(key, cleartext, opts)\n  },\n  decrypt: (alg, key, ciphertext, opts) => {\n    check(key, 'decrypt', alg)\n    return JWA.decrypt.get(alg)(key, ciphertext, opts)\n  }\n}\n"]},"metadata":{},"sourceType":"script"}