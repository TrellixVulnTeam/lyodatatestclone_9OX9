{"ast":null,"code":"var _defineProperty = require(\"/Users/suryanandsunil/Desktop/proto1-arizon/lyo-test/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/defineProperty\");\n\nvar _require = require('../../help/runtime_support'),\n    improvedDH = _require.improvedDH;\n\nvar _require2 = require('../../help/consts'),\n    KEYOBJECT = _require2.KEYOBJECT;\n\nvar _require3 = require('../../jwk/generate'),\n    generateSync = _require3.generateSync;\n\nvar _require4 = require('../../registry'),\n    ECDH_DERIVE_LENGTHS = _require4.ECDH_DERIVE_LENGTHS;\n\nvar derive = require('./derive');\n\nvar wrapKey = function wrapKey(wrap, derive, key, payload) {\n  var epk = generateSync(key.kty, key.crv);\n  var derivedKey = derive(epk, key, payload);\n  var result = wrap(_defineProperty({}, KEYOBJECT, derivedKey), payload);\n  result.header = result.header || {};\n  Object.assign(result.header, {\n    epk: {\n      kty: key.kty,\n      crv: key.crv,\n      x: epk.x,\n      y: epk.y\n    }\n  });\n  return result;\n};\n\nvar unwrapKey = function unwrapKey(unwrap, derive, key, payload, header) {\n  var epk = header.epk;\n  var derivedKey = derive(key, epk, header);\n  return unwrap(_defineProperty({}, KEYOBJECT, derivedKey), payload, header);\n};\n\nmodule.exports = function (JWA, JWK) {\n  ['ECDH-ES+A128KW', 'ECDH-ES+A192KW', 'ECDH-ES+A256KW'].forEach(function (jwaAlg) {\n    var kw = jwaAlg.substr(-6);\n    var kwWrap = JWA.keyManagementEncrypt.get(kw);\n    var kwUnwrap = JWA.keyManagementDecrypt.get(kw);\n    var keylen = parseInt(jwaAlg.substr(9, 3), 10);\n    ECDH_DERIVE_LENGTHS.set(jwaAlg, keylen);\n\n    if (kwWrap && kwUnwrap) {\n      JWA.keyManagementEncrypt.set(jwaAlg, wrapKey.bind(undefined, kwWrap, derive.bind(undefined, jwaAlg, keylen)));\n      JWA.keyManagementDecrypt.set(jwaAlg, unwrapKey.bind(undefined, kwUnwrap, derive.bind(undefined, jwaAlg, keylen)));\n\n      JWK.EC.deriveKey[jwaAlg] = function (key) {\n        return (key.use === 'enc' || key.use === undefined) && key.crv !== 'secp256k1';\n      };\n\n      if (improvedDH) {\n        JWK.OKP.deriveKey[jwaAlg] = function (key) {\n          return (key.use === 'enc' || key.use === undefined) && key.keyObject.asymmetricKeyType.startsWith('x');\n        };\n      }\n    }\n  });\n};\n\nmodule.exports.wrapKey = wrapKey;\nmodule.exports.unwrapKey = unwrapKey;","map":{"version":3,"sources":["/Users/suryanandsunil/Desktop/proto1-arizon/lyo-test/node_modules/jose/lib/jwa/ecdh/kw.js"],"names":["require","improvedDH","KEYOBJECT","generateSync","ECDH_DERIVE_LENGTHS","derive","wrapKey","wrap","key","payload","epk","kty","crv","derivedKey","result","header","Object","assign","x","y","unwrapKey","unwrap","module","exports","JWA","JWK","forEach","jwaAlg","kw","substr","kwWrap","keyManagementEncrypt","get","kwUnwrap","keyManagementDecrypt","keylen","parseInt","set","bind","undefined","EC","deriveKey","use","OKP","keyObject","asymmetricKeyType","startsWith"],"mappings":"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","sourcesContent":["const { improvedDH } = require('../../help/runtime_support')\nconst { KEYOBJECT } = require('../../help/consts')\nconst { generateSync } = require('../../jwk/generate')\nconst { ECDH_DERIVE_LENGTHS } = require('../../registry')\n\nconst derive = require('./derive')\n\nconst wrapKey = (wrap, derive, key, payload) => {\n  const epk = generateSync(key.kty, key.crv)\n\n  const derivedKey = derive(epk, key, payload)\n\n  const result = wrap({ [KEYOBJECT]: derivedKey }, payload)\n  result.header = result.header || {}\n  Object.assign(result.header, { epk: { kty: key.kty, crv: key.crv, x: epk.x, y: epk.y } })\n\n  return result\n}\n\nconst unwrapKey = (unwrap, derive, key, payload, header) => {\n  const { epk } = header\n  const derivedKey = derive(key, epk, header)\n\n  return unwrap({ [KEYOBJECT]: derivedKey }, payload, header)\n}\n\nmodule.exports = (JWA, JWK) => {\n  ['ECDH-ES+A128KW', 'ECDH-ES+A192KW', 'ECDH-ES+A256KW'].forEach((jwaAlg) => {\n    const kw = jwaAlg.substr(-6)\n    const kwWrap = JWA.keyManagementEncrypt.get(kw)\n    const kwUnwrap = JWA.keyManagementDecrypt.get(kw)\n    const keylen = parseInt(jwaAlg.substr(9, 3), 10)\n    ECDH_DERIVE_LENGTHS.set(jwaAlg, keylen)\n\n    if (kwWrap && kwUnwrap) {\n      JWA.keyManagementEncrypt.set(jwaAlg, wrapKey.bind(undefined, kwWrap, derive.bind(undefined, jwaAlg, keylen)))\n      JWA.keyManagementDecrypt.set(jwaAlg, unwrapKey.bind(undefined, kwUnwrap, derive.bind(undefined, jwaAlg, keylen)))\n      JWK.EC.deriveKey[jwaAlg] = key => (key.use === 'enc' || key.use === undefined) && key.crv !== 'secp256k1'\n\n      if (improvedDH) {\n        JWK.OKP.deriveKey[jwaAlg] = key => (key.use === 'enc' || key.use === undefined) && key.keyObject.asymmetricKeyType.startsWith('x')\n      }\n    }\n  })\n}\nmodule.exports.wrapKey = wrapKey\nmodule.exports.unwrapKey = unwrapKey\n"]},"metadata":{},"sourceType":"script"}