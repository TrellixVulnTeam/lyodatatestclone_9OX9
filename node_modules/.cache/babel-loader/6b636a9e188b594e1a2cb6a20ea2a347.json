{"ast":null,"code":"'use strict';\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nfunction _classCallCheck(instance, Constructor) {\n  if (!(instance instanceof Constructor)) {\n    throw new TypeError(\"Cannot call a class as a function\");\n  }\n}\n\nvar _require = require('./util'),\n    pathOr = _require.pathOr;\n\nvar State = function State() {\n  var _this = this;\n\n  _classCallCheck(this, State);\n\n  Object.defineProperty(this, 'pubSubCount', {\n    enumerable: true,\n    writable: true,\n    value: function value() {\n      var publishers = _this.publishers,\n          subscribers = _this.subscribers;\n      /* eslint-disable no-param-reassign */\n\n      var pubs = Object.keys(publishers).reduce(function (acc, source) {\n        acc[source] = Object.keys(publishers[source]).length;\n        acc.total += acc[source];\n        return acc;\n      }, {\n        camera: 0,\n        screen: 0,\n        custom: 0,\n        total: 0\n      });\n      var subs = Object.keys(subscribers).reduce(function (acc, source) {\n        acc[source] = Object.keys(subscribers[source]).length;\n        acc.total += acc[source];\n        return acc;\n      }, {\n        camera: 0,\n        screen: 0,\n        sip: 0,\n        custom: 0,\n        total: 0\n      });\n      /* eslint-enable no-param-reassign */\n\n      return {\n        publisher: pubs,\n        subscriber: subs\n      };\n    }\n  });\n  Object.defineProperty(this, 'getPubSub', {\n    enumerable: true,\n    writable: true,\n    value: function value() {\n      var publishers = _this.publishers,\n          subscribers = _this.subscribers,\n          pubSubCount = _this.pubSubCount;\n      return {\n        publishers: publishers,\n        subscribers: subscribers,\n        meta: pubSubCount()\n      };\n    }\n  });\n  Object.defineProperty(this, 'all', {\n    enumerable: true,\n    writable: true,\n    value: function value() {\n      var streams = _this.streams,\n          streamMap = _this.streamMap,\n          getPubSub = _this.getPubSub;\n      return Object.assign({}, {\n        streams: streams,\n        streamMap: streamMap\n      }, getPubSub());\n    }\n  });\n  Object.defineProperty(this, 'getSession', {\n    enumerable: true,\n    writable: true,\n    value: function value() {\n      return _this.session;\n    }\n  });\n  Object.defineProperty(this, 'setSession', {\n    enumerable: true,\n    writable: true,\n    value: function value(otSession) {\n      _this.session = otSession;\n    }\n  });\n  Object.defineProperty(this, 'getCredentials', {\n    enumerable: true,\n    writable: true,\n    value: function value() {\n      return _this.credentials;\n    }\n  });\n  Object.defineProperty(this, 'setCredentials', {\n    enumerable: true,\n    writable: true,\n    value: function value(otCredentials) {\n      _this.credentials = otCredentials;\n    }\n  });\n  Object.defineProperty(this, 'getOptions', {\n    enumerable: true,\n    writable: true,\n    value: function value() {\n      return _this.options;\n    }\n  });\n  Object.defineProperty(this, 'setOptions', {\n    enumerable: true,\n    writable: true,\n    value: function value(otOptions) {\n      _this.options = otOptions;\n    }\n  });\n  Object.defineProperty(this, 'addStream', {\n    enumerable: true,\n    writable: true,\n    value: function value(stream) {\n      _this.streams[stream.id] = stream;\n    }\n  });\n  Object.defineProperty(this, 'removeStream', {\n    enumerable: true,\n    writable: true,\n    value: function value(stream) {\n      var streamMap = _this.streamMap,\n          subscribers = _this.subscribers,\n          streams = _this.streams;\n      var type = pathOr('sip', 'videoType', stream);\n      var subscriberId = streamMap[stream.id];\n      delete streamMap[stream.id];\n      delete subscribers[type][subscriberId];\n      delete streams[stream.id];\n    }\n  });\n  Object.defineProperty(this, 'getStreams', {\n    enumerable: true,\n    writable: true,\n    value: function value() {\n      return _this.streams;\n    }\n  });\n  Object.defineProperty(this, 'getStreamMap', {\n    enumerable: true,\n    writable: true,\n    value: function value() {\n      return _this.streamMap;\n    }\n  });\n  Object.defineProperty(this, 'addPublisher', {\n    enumerable: true,\n    writable: true,\n    value: function value(type, publisher) {\n      _this.streamMap[publisher.streamId] = publisher.id;\n      _this.publishers[type][publisher.id] = publisher;\n    }\n  });\n  Object.defineProperty(this, 'removePublisher', {\n    enumerable: true,\n    writable: true,\n    value: function value(type, publisher) {\n      var streamMap = _this.streamMap,\n          publishers = _this.publishers;\n      var id = publisher.id || streamMap[publisher.streamId];\n\n      if (id == null) {\n        throw 'Publisher no longer exists. It may have been previously destroyed.';\n      }\n\n      delete publishers[type][id];\n      delete streamMap[publisher.streamId];\n    }\n  });\n  Object.defineProperty(this, 'removeAllPublishers', {\n    enumerable: true,\n    writable: true,\n    value: function value() {\n      var publishers = _this.publishers,\n          removePublisher = _this.removePublisher;\n      ['camera', 'screen', 'custom'].forEach(function (type) {\n        Object.values(publishers[type]).forEach(function (publisher) {\n          removePublisher(type, publisher);\n        });\n      });\n    }\n  });\n  Object.defineProperty(this, 'addSubscriber', {\n    enumerable: true,\n    writable: true,\n    value: function value(subscriber) {\n      var subscribers = _this.subscribers,\n          streamMap = _this.streamMap;\n      var streamId = subscriber.stream.id;\n      var type = pathOr('sip', 'stream.videoType', subscriber);\n      subscribers[type][subscriber.id] = subscriber;\n      streamMap[streamId] = subscriber.id;\n    }\n  });\n  Object.defineProperty(this, 'removeSubscriber', {\n    enumerable: true,\n    writable: true,\n    value: function value(type, subscriber) {\n      var subscribers = _this.subscribers,\n          streamMap = _this.streamMap;\n      var id = subscriber.id || streamMap[subscriber.streamId];\n\n      if (id == null) {\n        throw 'Subscriber no longer exists. It may have been previously destroyed.';\n      }\n\n      delete subscribers[type][id];\n      delete streamMap[subscriber.streamId];\n    }\n  });\n  Object.defineProperty(this, 'removeAllSubscribers', {\n    enumerable: true,\n    writable: true,\n    value: function value() {\n      ['camera', 'screen', 'sip', 'custom'].forEach(function (type) {\n        Object.values(_this.subscribers[type]).forEach(function (subscriber) {\n          _this.removeSubscriber(type, subscriber);\n        });\n      });\n    }\n  });\n  Object.defineProperty(this, 'reset', {\n    enumerable: true,\n    writable: true,\n    value: function value() {\n      var removeAllPublishers = _this.removeAllPublishers,\n          removeAllSubscribers = _this.removeAllSubscribers,\n          streams = _this.streams,\n          streamMap = _this.streamMap;\n      removeAllPublishers();\n      removeAllSubscribers();\n      [streams, streamMap].forEach(function (streamObj) {\n        Object.keys(streamObj).forEach(function (streamId) {\n          delete streamObj[streamId]; // eslint-disable-line no-param-reassign\n        });\n      });\n    }\n  });\n  this.publishers = {\n    camera: {},\n    screen: {},\n    custom: {}\n  }; // Map subscriber id to subscriber objects\n\n  this.subscribers = {\n    camera: {},\n    screen: {},\n    sip: {},\n    custom: {}\n  }; // Map stream ids to stream objects\n\n  this.streams = {}; // Map stream ids to subscriber/publisher ids\n\n  this.streamMap = {}; // The OpenTok session\n\n  this.session = null; // OpenTok session credentials\n\n  this.credentials = null; // Core options\n\n  this.options = null;\n}\n/**\n* Internal methods\n*/\n\n/**\n* Returns the count of current publishers and subscribers by type\n * @returns {Object}\n *    {\n *      publishers: {\n *        camera: 1,\n *        screen: 1,\n *        custom: 0,\n *        total: 2\n *      },\n *      subscribers: {\n *        camera: 3,\n *        screen: 1,\n *        custom: 0,\n *        total: 4\n *      }\n *   }\n */\n\n/**\n * Returns the current publishers and subscribers, along with a count of each\n * @returns {Object}\n */\n\n/**\n * Get streams, streamMap, publishers, and subscribers\n * @return {Object}\n */\n\n/**\n * Get the current OpenTok session\n * @returns {Object}\n */\n\n/**\n * Set the current OpenTok session\n * @param {Object} otSession\n */\n\n/**\n * Get the current OpenTok credentials\n * @returns {Object}\n */\n\n/**\n * Set the current OpenTok credentials\n * @param {Object} otCredentials\n */\n\n/**\n * Get the options defined for core\n * @returns {Object}\n */\n\n/**\n * Set the options defined for core\n * @param {Object} otOptions\n */\n\n/**\n * Add a stream to state\n * @param {Object} stream - An OpenTok stream object\n */\n\n/**\n * Remove a stream from state and any associated subscribers\n * @param {Object} stream - An OpenTok stream object\n */\n\n/**\n * Get all remote streams\n * @returns {Object}\n */\n\n/**\n * Get the map of stream ids to publisher/subscriber ids\n * @returns {Object}\n */\n\n/**\n * Add a publisher to state\n * @param {String} type - 'camera' or 'screen'\n * @param {Object} publisher - The OpenTok publisher object\n */\n\n/**\n * Remove a publisher from state\n * @param {String} type - 'camera' or 'screen'\n * @param {Object} publisher - The OpenTok publisher object\n */\n\n/**\n * Remove all publishers from state\n */\n\n/**\n * Add a subscriber to state\n * @param {Object} - An OpenTok subscriber object\n */\n\n/**\n * Remove a publisher from state\n * @param {String} type - 'camera' or 'screen'\n * @param {Object} subscriber - The OpenTok subscriber object\n */\n\n/**\n * Remove all subscribers from state\n */\n\n/**\n * Reset state\n */\n;\n/** Export */\n\n\nexports.default = State;","map":{"version":3,"sources":["/Users/suryanandsunil/Desktop/proto1-arizon/lyo-test/node_modules/opentok-accelerator-core/dist/state.js"],"names":["Object","defineProperty","exports","value","_classCallCheck","instance","Constructor","TypeError","_require","require","pathOr","State","_this","enumerable","writable","publishers","subscribers","pubs","keys","reduce","acc","source","length","total","camera","screen","custom","subs","sip","publisher","subscriber","pubSubCount","meta","streams","streamMap","getPubSub","assign","session","otSession","credentials","otCredentials","options","otOptions","stream","id","type","subscriberId","streamId","removePublisher","forEach","values","removeSubscriber","removeAllPublishers","removeAllSubscribers","streamObj","default"],"mappings":"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","sourcesContent":["'use strict';\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nvar _require = require('./util'),\n    pathOr = _require.pathOr;\n\nvar State = function State() {\n  var _this = this;\n\n  _classCallCheck(this, State);\n\n  Object.defineProperty(this, 'pubSubCount', {\n    enumerable: true,\n    writable: true,\n    value: function value() {\n      var publishers = _this.publishers,\n          subscribers = _this.subscribers;\n      /* eslint-disable no-param-reassign */\n\n      var pubs = Object.keys(publishers).reduce(function (acc, source) {\n        acc[source] = Object.keys(publishers[source]).length;\n        acc.total += acc[source];\n        return acc;\n      }, { camera: 0, screen: 0, custom: 0, total: 0 });\n\n      var subs = Object.keys(subscribers).reduce(function (acc, source) {\n        acc[source] = Object.keys(subscribers[source]).length;\n        acc.total += acc[source];\n        return acc;\n      }, { camera: 0, screen: 0, sip: 0, custom: 0, total: 0 });\n      /* eslint-enable no-param-reassign */\n      return { publisher: pubs, subscriber: subs };\n    }\n  });\n  Object.defineProperty(this, 'getPubSub', {\n    enumerable: true,\n    writable: true,\n    value: function value() {\n      var publishers = _this.publishers,\n          subscribers = _this.subscribers,\n          pubSubCount = _this.pubSubCount;\n\n      return { publishers: publishers, subscribers: subscribers, meta: pubSubCount() };\n    }\n  });\n  Object.defineProperty(this, 'all', {\n    enumerable: true,\n    writable: true,\n    value: function value() {\n      var streams = _this.streams,\n          streamMap = _this.streamMap,\n          getPubSub = _this.getPubSub;\n\n      return Object.assign({}, { streams: streams, streamMap: streamMap }, getPubSub());\n    }\n  });\n  Object.defineProperty(this, 'getSession', {\n    enumerable: true,\n    writable: true,\n    value: function value() {\n      return _this.session;\n    }\n  });\n  Object.defineProperty(this, 'setSession', {\n    enumerable: true,\n    writable: true,\n    value: function value(otSession) {\n      _this.session = otSession;\n    }\n  });\n  Object.defineProperty(this, 'getCredentials', {\n    enumerable: true,\n    writable: true,\n    value: function value() {\n      return _this.credentials;\n    }\n  });\n  Object.defineProperty(this, 'setCredentials', {\n    enumerable: true,\n    writable: true,\n    value: function value(otCredentials) {\n      _this.credentials = otCredentials;\n    }\n  });\n  Object.defineProperty(this, 'getOptions', {\n    enumerable: true,\n    writable: true,\n    value: function value() {\n      return _this.options;\n    }\n  });\n  Object.defineProperty(this, 'setOptions', {\n    enumerable: true,\n    writable: true,\n    value: function value(otOptions) {\n      _this.options = otOptions;\n    }\n  });\n  Object.defineProperty(this, 'addStream', {\n    enumerable: true,\n    writable: true,\n    value: function value(stream) {\n      _this.streams[stream.id] = stream;\n    }\n  });\n  Object.defineProperty(this, 'removeStream', {\n    enumerable: true,\n    writable: true,\n    value: function value(stream) {\n      var streamMap = _this.streamMap,\n          subscribers = _this.subscribers,\n          streams = _this.streams;\n\n      var type = pathOr('sip', 'videoType', stream);\n      var subscriberId = streamMap[stream.id];\n      delete streamMap[stream.id];\n      delete subscribers[type][subscriberId];\n      delete streams[stream.id];\n    }\n  });\n  Object.defineProperty(this, 'getStreams', {\n    enumerable: true,\n    writable: true,\n    value: function value() {\n      return _this.streams;\n    }\n  });\n  Object.defineProperty(this, 'getStreamMap', {\n    enumerable: true,\n    writable: true,\n    value: function value() {\n      return _this.streamMap;\n    }\n  });\n  Object.defineProperty(this, 'addPublisher', {\n    enumerable: true,\n    writable: true,\n    value: function value(type, publisher) {\n      _this.streamMap[publisher.streamId] = publisher.id;\n      _this.publishers[type][publisher.id] = publisher;\n    }\n  });\n  Object.defineProperty(this, 'removePublisher', {\n    enumerable: true,\n    writable: true,\n    value: function value(type, publisher) {\n      var streamMap = _this.streamMap,\n          publishers = _this.publishers;\n\n      var id = publisher.id || streamMap[publisher.streamId];\n      if (id == null) {\n        throw 'Publisher no longer exists. It may have been previously destroyed.';\n      }\n      delete publishers[type][id];\n      delete streamMap[publisher.streamId];\n    }\n  });\n  Object.defineProperty(this, 'removeAllPublishers', {\n    enumerable: true,\n    writable: true,\n    value: function value() {\n      var publishers = _this.publishers,\n          removePublisher = _this.removePublisher;\n\n      ['camera', 'screen', 'custom'].forEach(function (type) {\n        Object.values(publishers[type]).forEach(function (publisher) {\n          removePublisher(type, publisher);\n        });\n      });\n    }\n  });\n  Object.defineProperty(this, 'addSubscriber', {\n    enumerable: true,\n    writable: true,\n    value: function value(subscriber) {\n      var subscribers = _this.subscribers,\n          streamMap = _this.streamMap;\n\n      var streamId = subscriber.stream.id;\n      var type = pathOr('sip', 'stream.videoType', subscriber);\n      subscribers[type][subscriber.id] = subscriber;\n      streamMap[streamId] = subscriber.id;\n    }\n  });\n  Object.defineProperty(this, 'removeSubscriber', {\n    enumerable: true,\n    writable: true,\n    value: function value(type, subscriber) {\n      var subscribers = _this.subscribers,\n          streamMap = _this.streamMap;\n\n      var id = subscriber.id || streamMap[subscriber.streamId];\n      if (id == null) {\n        throw 'Subscriber no longer exists. It may have been previously destroyed.';\n      }\n      delete subscribers[type][id];\n      delete streamMap[subscriber.streamId];\n    }\n  });\n  Object.defineProperty(this, 'removeAllSubscribers', {\n    enumerable: true,\n    writable: true,\n    value: function value() {\n      ['camera', 'screen', 'sip', 'custom'].forEach(function (type) {\n        Object.values(_this.subscribers[type]).forEach(function (subscriber) {\n          _this.removeSubscriber(type, subscriber);\n        });\n      });\n    }\n  });\n  Object.defineProperty(this, 'reset', {\n    enumerable: true,\n    writable: true,\n    value: function value() {\n      var removeAllPublishers = _this.removeAllPublishers,\n          removeAllSubscribers = _this.removeAllSubscribers,\n          streams = _this.streams,\n          streamMap = _this.streamMap;\n\n      removeAllPublishers();\n      removeAllSubscribers();\n      [streams, streamMap].forEach(function (streamObj) {\n        Object.keys(streamObj).forEach(function (streamId) {\n          delete streamObj[streamId]; // eslint-disable-line no-param-reassign\n        });\n      });\n    }\n  });\n\n  this.publishers = {\n    camera: {},\n    screen: {},\n    custom: {}\n  };\n\n  // Map subscriber id to subscriber objects\n  this.subscribers = {\n    camera: {},\n    screen: {},\n    sip: {},\n    custom: {}\n  };\n\n  // Map stream ids to stream objects\n  this.streams = {};\n\n  // Map stream ids to subscriber/publisher ids\n  this.streamMap = {};\n\n  // The OpenTok session\n  this.session = null;\n\n  // OpenTok session credentials\n  this.credentials = null;\n\n  // Core options\n  this.options = null;\n}\n/**\n* Internal methods\n*/\n\n/**\n* Returns the count of current publishers and subscribers by type\n * @returns {Object}\n *    {\n *      publishers: {\n *        camera: 1,\n *        screen: 1,\n *        custom: 0,\n *        total: 2\n *      },\n *      subscribers: {\n *        camera: 3,\n *        screen: 1,\n *        custom: 0,\n *        total: 4\n *      }\n *   }\n */\n\n\n/**\n * Returns the current publishers and subscribers, along with a count of each\n * @returns {Object}\n */\n\n\n/**\n * Get streams, streamMap, publishers, and subscribers\n * @return {Object}\n */\n\n\n/**\n * Get the current OpenTok session\n * @returns {Object}\n */\n\n\n/**\n * Set the current OpenTok session\n * @param {Object} otSession\n */\n\n\n/**\n * Get the current OpenTok credentials\n * @returns {Object}\n */\n\n\n/**\n * Set the current OpenTok credentials\n * @param {Object} otCredentials\n */\n\n\n/**\n * Get the options defined for core\n * @returns {Object}\n */\n\n\n/**\n * Set the options defined for core\n * @param {Object} otOptions\n */\n\n\n/**\n * Add a stream to state\n * @param {Object} stream - An OpenTok stream object\n */\n\n\n/**\n * Remove a stream from state and any associated subscribers\n * @param {Object} stream - An OpenTok stream object\n */\n\n\n/**\n * Get all remote streams\n * @returns {Object}\n */\n\n\n/**\n * Get the map of stream ids to publisher/subscriber ids\n * @returns {Object}\n */\n\n\n/**\n * Add a publisher to state\n * @param {String} type - 'camera' or 'screen'\n * @param {Object} publisher - The OpenTok publisher object\n */\n\n\n/**\n * Remove a publisher from state\n * @param {String} type - 'camera' or 'screen'\n * @param {Object} publisher - The OpenTok publisher object\n */\n\n\n/**\n * Remove all publishers from state\n */\n\n\n/**\n * Add a subscriber to state\n * @param {Object} - An OpenTok subscriber object\n */\n\n\n/**\n * Remove a publisher from state\n * @param {String} type - 'camera' or 'screen'\n * @param {Object} subscriber - The OpenTok subscriber object\n */\n\n\n/**\n * Remove all subscribers from state\n */\n\n\n/**\n * Reset state\n */\n;\n\n/** Export */\n\n\nexports.default = State;"]},"metadata":{},"sourceType":"script"}