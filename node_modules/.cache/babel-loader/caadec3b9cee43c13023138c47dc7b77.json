{"ast":null,"code":"'use strict';\n\nvar _typeof = typeof Symbol === \"function\" && typeof Symbol.iterator === \"symbol\" ? function (obj) {\n  return typeof obj;\n} : function (obj) {\n  return obj && typeof Symbol === \"function\" && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj;\n};\n\nfunction _classCallCheck(instance, Constructor) {\n  if (!(instance instanceof Constructor)) {\n    throw new TypeError(\"Cannot call a class as a function\");\n  }\n}\n/* global OT */\n\n/**\n * Dependencies\n */\n\n\nvar util = require('./util');\n\nvar State = require('./state').default;\n\nvar accPackEvents = require('./events');\n\nvar Communication = require('./communication').default;\n\nvar OpenTokSDK = require('./sdk-wrapper/sdkWrapper');\n\nvar _require = require('./errors'),\n    CoreError = _require.CoreError;\n\nvar _require2 = require('./logging'),\n    message = _require2.message,\n    Analytics = _require2.Analytics,\n    logAction = _require2.logAction,\n    logVariation = _require2.logVariation;\n/**\n * Helper methods\n */\n\n\nvar dom = util.dom,\n    path = util.path,\n    pathOr = util.pathOr,\n    properCase = util.properCase;\n/**\n * Ensure that we have the required credentials\n * @param {Object} credentials\n * @param {String} credentials.apiKey\n * @param {String} credentials.sessionId\n * @param {String} credentials.token\n */\n\nvar validateCredentials = function validateCredentials() {\n  var credentials = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : [];\n  var required = ['apiKey', 'sessionId', 'token'];\n  required.forEach(function (credential) {\n    if (!credentials[credential]) {\n      throw new CoreError(credential + ' is a required credential', 'invalidParameters');\n    }\n  });\n};\n\nvar AccCore = function AccCore(options) {\n  _classCallCheck(this, AccCore);\n\n  _initialiseProps.call(this); // Options/credentials validation\n\n\n  if (!options) {\n    throw new CoreError('Missing options required for initialization', 'invalidParameters');\n  }\n\n  var credentials = options.credentials;\n  validateCredentials(options.credentials);\n  this.name = options.name; // Init analytics\n\n  this.applicationName = options.applicationName;\n  this.analytics = new Analytics(window.location.origin, credentials.sessionId, null, credentials.apiKey);\n  this.analytics.log(logAction.init, logVariation.attempt); // Create session, setup state\n\n  var sessionProps = options.largeScale ? {\n    connectionEventsSuppressed: true\n  } : undefined;\n  this.session = OT.initSession(credentials.apiKey, credentials.sessionId, sessionProps);\n  this.internalState = new State();\n  this.internalState.setSession(this.session);\n  this.internalState.setCredentials(credentials);\n  this.internalState.setOptions(options); // Individual accelerator packs\n\n  this.communication = null;\n  this.textChat = null;\n  this.screenSharing = null;\n  this.annotation = null;\n  this.archiving = null; // Create internal event listeners\n\n  this.createEventListeners(this.session, options);\n  this.analytics.log(logAction.init, logVariation.success);\n} // OpenTok SDK Wrapper\n// Expose utility methods\n\n/**\n * Get access to an accelerator pack\n * @param {String} packageName - textChat, screenSharing, annotation, or archiving\n * @returns {Object} The instance of the accelerator pack\n */\n\n/** Eventing */\n\n/**\n * Register events that can be listened to be other components/modules\n * @param {array | string} events - A list of event names. A single event may\n * also be passed as a string.\n */\n\n/**\n * Register a callback for a specific event or pass an object with\n * with event => callback key/value pairs to register listeners for\n * multiple events.\n * @param {String | Object} event - The name of the event\n * @param {Function} callback\n */\n\n/**\n * Remove a callback for a specific event.  If no parameters are passed,\n * all event listeners will be removed.\n * @param {String} event - The name of the event\n * @param {Function} callback\n */\n\n/**\n * Trigger an event and fire all registered callbacks\n * @param {String} event - The name of the event\n * @param {*} data - Data to be passed to callback functions\n */\n\n/**\n * Get the current OpenTok session object\n * @returns {Object}\n */\n\n/**\n * Returns the current OpenTok session credentials\n * @returns {Object}\n */\n\n/**\n * Returns the options used for initialization\n * @returns {Object}\n */\n\n/**\n * Connect to the session\n * @returns {Promise} <resolve: -, reject: Error>\n */\n\n/**\n * Disconnect from the session\n * @returns {Promise} <resolve: -, reject: Error>\n */\n\n/**\n * Force a remote connection to leave the session\n * @param {Object} connection\n * @returns {Promise} <resolve: empty, reject: Error>\n */\n\n/**\n * Start publishing video and subscribing to streams\n * @param {Object} publisherProps - https://goo.gl/0mL0Eo\n * @returns {Promise} <resolve: State + Publisher, reject: Error>\n */\n\n/**\n * Stop all publishing un unsubscribe from all streams\n * @returns {void}\n */\n\n/**\n * Start publishing video and subscribing to streams\n * @returns {Object} The internal state of the core session\n */\n\n/**\n * Manually subscribe to a stream\n * @param {Object} stream - An OpenTok stream\n * @param {Object} [subscriberProperties] - https://tokbox.com/developer/sdks/js/reference/Session.html#subscribe\n * @param {Boolean} [networkTest] - Subscribing to our own publisher as part of a network test?\n * @returns {Promise} <resolve: Subscriber, reject: Error>\n */\n\n/**\n * Manually unsubscribe from a stream\n * @param {Object} subscriber - An OpenTok subscriber object\n * @returns {Promise} <resolve: void, reject: Error>\n */\n\n/**\n * Force the publisher of a stream to stop publishing the stream\n * @param {Object} stream\n * @returns {Promise} <resolve: empty, reject: Error>\n */\n\n/**\n * Get the local publisher object for a stream\n * @param {Object} stream - An OpenTok stream object\n * @returns {Object} - The publisher object\n */\n\n/**\n * Get the local subscriber objects for a stream\n * @param {Object} stream - An OpenTok stream object\n * @returns {Array} - An array of subscriber object\n */\n\n/**\n * Send a signal using the OpenTok signaling apiKey\n * @param {String} type\n * @param {*} [data]\n * @param {Object} [to] - An OpenTok connection object\n * @returns {Promise} <resolve: empty, reject: Error>\n */\n\n/**\n * Enable or disable local audio\n * @param {Boolean} enable\n */\n\n/**\n * Enable or disable local video\n * @param {Boolean} enable\n */\n\n/**\n * Enable or disable remote audio\n * @param {String} id - Subscriber id\n * @param {Boolean} enable\n */\n\n/**\n * Enable or disable remote video\n * @param {String} id - Subscriber id\n * @param {Boolean} enable\n */\n;\n\nObject.defineProperty(AccCore, 'OpenTokSDK', {\n  enumerable: true,\n  writable: true,\n  value: OpenTokSDK\n});\nObject.defineProperty(AccCore, 'util', {\n  enumerable: true,\n  writable: true,\n  value: util\n});\n\nvar _initialiseProps = function _initialiseProps() {\n  var _this = this;\n\n  Object.defineProperty(this, 'getAccPack', {\n    enumerable: true,\n    writable: true,\n    value: function value(packageName) {\n      var analytics = _this.analytics,\n          textChat = _this.textChat,\n          screenSharing = _this.screenSharing,\n          annotation = _this.annotation,\n          archiving = _this.archiving;\n      analytics.log(logAction.getAccPack, logVariation.attempt);\n      var packages = {\n        textChat: textChat,\n        screenSharing: screenSharing,\n        annotation: annotation,\n        archiving: archiving\n      };\n      analytics.log(logAction.getAccPack, logVariation.success);\n      return packages[packageName];\n    }\n  });\n  Object.defineProperty(this, 'registerEvents', {\n    enumerable: true,\n    writable: true,\n    value: function value(events) {\n      var eventListeners = _this.eventListeners;\n      var eventList = Array.isArray(events) ? events : [events];\n      eventList.forEach(function (event) {\n        if (!eventListeners[event]) {\n          eventListeners[event] = new Set();\n        }\n      });\n    }\n  });\n  Object.defineProperty(this, 'on', {\n    enumerable: true,\n    writable: true,\n    value: function value(event, callback) {\n      var eventListeners = _this.eventListeners,\n          on = _this.on; // analytics.log(logAction.on, logVariation.attempt);\n\n      if ((typeof event === 'undefined' ? 'undefined' : _typeof(event)) === 'object') {\n        Object.keys(event).forEach(function (eventName) {\n          on(eventName, event[eventName]);\n        });\n        return;\n      }\n\n      var eventCallbacks = eventListeners[event];\n\n      if (!eventCallbacks) {\n        message(event + ' is not a registered event.'); // analytics.log(logAction.on, logVariation.fail);\n      } else {\n        eventCallbacks.add(callback); // analytics.log(logAction.on, logVariation.success);\n      }\n    }\n  });\n  Object.defineProperty(this, 'off', {\n    enumerable: true,\n    writable: true,\n    value: function value(event, callback) {\n      var eventListeners = _this.eventListeners; // analytics.log(logAction.off, logVariation.attempt);\n\n      if (!event && !callback) {\n        Object.keys(eventListeners).forEach(function (eventType) {\n          eventListeners[eventType].clear();\n        });\n      } else {\n        var eventCallbacks = eventListeners[event];\n\n        if (!eventCallbacks) {\n          // analytics.log(logAction.off, logVariation.fail);\n          message(event + ' is not a registered event.');\n        } else {\n          eventCallbacks.delete(callback); // analytics.log(logAction.off, logVariation.success);\n        }\n      }\n    }\n  });\n  Object.defineProperty(this, 'triggerEvent', {\n    enumerable: true,\n    writable: true,\n    value: function value(event, data) {\n      var eventListeners = _this.eventListeners,\n          registerEvents = _this.registerEvents;\n      var eventCallbacks = eventListeners[event];\n\n      if (!eventCallbacks) {\n        registerEvents(event);\n        message(event + ' has been registered as a new event.');\n      } else {\n        eventCallbacks.forEach(function (callback) {\n          return callback(data, event);\n        });\n      }\n    }\n  });\n  Object.defineProperty(this, 'getSession', {\n    enumerable: true,\n    writable: true,\n    value: function value() {\n      return _this.internalState.getSession();\n    }\n  });\n  Object.defineProperty(this, 'getCredentials', {\n    enumerable: true,\n    writable: true,\n    value: function value() {\n      return _this.internalState.getCredentials();\n    }\n  });\n  Object.defineProperty(this, 'getOptions', {\n    enumerable: true,\n    writable: true,\n    value: function value() {\n      return _this.internalState.getOptions();\n    }\n  });\n  Object.defineProperty(this, 'createEventListeners', {\n    enumerable: true,\n    writable: true,\n    value: function value(session, options) {\n      _this.eventListeners = {};\n      var registerEvents = _this.registerEvents,\n          internalState = _this.internalState,\n          triggerEvent = _this.triggerEvent,\n          on = _this.on,\n          getSession = _this.getSession;\n      Object.keys(accPackEvents).forEach(function (type) {\n        return registerEvents(accPackEvents[type]);\n      });\n      /**\n       * If using screen sharing + annotation in an external window, the screen sharing\n       * package will take care of calling annotation.start() and annotation.linkCanvas()\n       */\n\n      var usingAnnotation = path('screenSharing.annotation', options);\n      var internalAnnotation = usingAnnotation && !path('screenSharing.externalWindow', options);\n      /**\n       * Wrap session events and update internalState when streams are created\n       * or destroyed\n       */\n\n      accPackEvents.session.forEach(function (eventName) {\n        session.on(eventName, function (event) {\n          if (eventName === 'streamCreated') {\n            internalState.addStream(event.stream);\n          }\n\n          if (eventName === 'streamDestroyed') {\n            internalState.removeStream(event.stream);\n          }\n\n          triggerEvent(eventName, event);\n        });\n      });\n\n      if (usingAnnotation) {\n        on('subscribeToScreen', function (_ref) {\n          var subscriber = _ref.subscriber;\n\n          _this.annotation.start(getSession()).then(function () {\n            var absoluteParent = dom.query(path('annotation.absoluteParent.subscriber', options));\n            var linkOptions = absoluteParent ? {\n              absoluteParent: absoluteParent\n            } : null;\n\n            _this.annotation.linkCanvas(subscriber, subscriber.element.parentElement, linkOptions);\n          });\n        });\n        on('unsubscribeFromScreen', function () {\n          _this.annotation.end();\n        });\n      }\n\n      on('startScreenSharing', function (publisher) {\n        internalState.addPublisher('screen', publisher);\n        triggerEvent('startScreenShare', Object.assign({}, {\n          publisher: publisher\n        }, internalState.getPubSub()));\n\n        if (internalAnnotation) {\n          _this.annotation.start(getSession()).then(function () {\n            var absoluteParent = dom.query(path('annotation.absoluteParent.publisher', options));\n            var linkOptions = absoluteParent ? {\n              absoluteParent: absoluteParent\n            } : null;\n\n            _this.annotation.linkCanvas(publisher, publisher.element.parentElement, linkOptions);\n          });\n        }\n      });\n      on('endScreenSharing', function (publisher) {\n        // delete publishers.screen[publisher.id];\n        internalState.removePublisher('screen', publisher);\n        triggerEvent('endScreenShare', internalState.getPubSub());\n\n        if (usingAnnotation) {\n          _this.annotation.end();\n        }\n      });\n    }\n  });\n  Object.defineProperty(this, 'setupExternalAnnotation', {\n    enumerable: true,\n    writable: true,\n    value: function value() {\n      return _this.annotation.start(_this.getSession(), {\n        screensharing: true\n      });\n    }\n  });\n  Object.defineProperty(this, 'linkAnnotation', {\n    enumerable: true,\n    writable: true,\n    value: function value(pubSub, annotationContainer, externalWindow) {\n      var annotation = _this.annotation,\n          internalState = _this.internalState;\n      annotation.linkCanvas(pubSub, annotationContainer, {\n        externalWindow: externalWindow\n      });\n\n      if (externalWindow) {\n        // Add subscribers to the external window\n        var streams = internalState.getStreams();\n        var cameraStreams = Object.keys(streams).reduce(function (acc, streamId) {\n          var stream = streams[streamId];\n          return stream.videoType === 'camera' || stream.videoType === 'sip' ? acc.concat(stream) : acc;\n        }, []);\n        cameraStreams.forEach(annotation.addSubscriberToExternalWindow);\n      }\n    }\n  });\n  Object.defineProperty(this, 'initPackages', {\n    enumerable: true,\n    writable: true,\n    value: function value() {\n      var analytics = _this.analytics,\n          getSession = _this.getSession,\n          getOptions = _this.getOptions,\n          internalState = _this.internalState;\n      var on = _this.on,\n          registerEvents = _this.registerEvents,\n          setupExternalAnnotation = _this.setupExternalAnnotation,\n          triggerEvent = _this.triggerEvent,\n          linkAnnotation = _this.linkAnnotation;\n      analytics.log(logAction.initPackages, logVariation.attempt);\n      var session = getSession();\n      var options = getOptions();\n      /**\n       * Try to require a package.  If 'require' is unavailable, look for\n       * the package in global scope.  A switch ttatement is used because\n       * webpack and Browserify aren't able to resolve require statements\n       * that use variable names.\n       * @param {String} packageName - The name of the npm package\n       * @param {String} globalName - The name of the package if exposed on global/window\n       * @returns {Object}\n       */\n\n      var optionalRequire = function optionalRequire(packageName, globalName) {\n        var result = void 0;\n        /* eslint-disable global-require, import/no-extraneous-dependencies, import/no-unresolved */\n\n        try {\n          switch (packageName) {\n            case 'opentok-text-chat':\n              result = require('opentok-text-chat');\n              break;\n\n            case 'opentok-screen-sharing':\n              result = require('opentok-screen-sharing');\n              break;\n\n            case 'opentok-annotation':\n              result = require('opentok-annotation');\n              break;\n\n            case 'opentok-archiving':\n              result = require('opentok-archiving');\n              break;\n\n            default:\n              break;\n          }\n          /* eslint-enable global-require */\n\n        } catch (error) {\n          result = window[globalName];\n        }\n\n        if (!result) {\n          analytics.log(logAction.initPackages, logVariation.fail);\n          throw new CoreError('Could not load ' + packageName, 'missingDependency');\n        }\n\n        return result;\n      };\n\n      var availablePackages = {\n        textChat: function textChat() {\n          return optionalRequire('opentok-text-chat', 'TextChatAccPack');\n        },\n        screenSharing: function screenSharing() {\n          return optionalRequire('opentok-screen-sharing', 'ScreenSharingAccPack');\n        },\n        annotation: function annotation() {\n          return optionalRequire('opentok-annotation', 'AnnotationAccPack');\n        },\n        archiving: function archiving() {\n          return optionalRequire('opentok-archiving', 'ArchivingAccPack');\n        }\n      };\n      var packages = {};\n      (path('packages', options) || []).forEach(function (acceleratorPack) {\n        if (availablePackages[acceleratorPack]) {\n          // eslint-disable-next-line no-param-reassign\n          packages[properCase(acceleratorPack)] = availablePackages[acceleratorPack]();\n        } else {\n          message(acceleratorPack + ' is not a valid accelerator pack');\n        }\n      });\n      /**\n       * Get containers for streams, controls, and the chat widget\n       */\n\n      var getDefaultContainer = function getDefaultContainer(pubSub) {\n        return document.getElementById(pubSub + 'Container');\n      };\n\n      var getContainerElements = function getContainerElements() {\n        // Need to use path to check for null values\n        var controls = pathOr('#videoControls', 'controlsContainer', options);\n        var chat = pathOr('#chat', 'textChat.container', options);\n        var stream = pathOr(getDefaultContainer, 'streamContainers', options);\n        return {\n          stream: stream,\n          controls: controls,\n          chat: chat\n        };\n      };\n      /** *** *** *** *** */\n\n      /**\n       * Return options for the specified package\n       * @param {String} packageName\n       * @returns {Object}\n       */\n\n\n      var packageOptions = function packageOptions(packageName) {\n        /**\n         * Methods to expose to accelerator packs\n         */\n        var accPack = {\n          registerEventListener: on,\n          // Legacy option\n          on: on,\n          registerEvents: registerEvents,\n          triggerEvent: triggerEvent,\n          setupExternalAnnotation: setupExternalAnnotation,\n          linkAnnotation: linkAnnotation\n        };\n        /**\n         * If options.controlsContainer/containers.controls is null,\n         * accelerator packs should not append their controls.\n         */\n\n        var containers = getContainerElements();\n        var appendControl = !!containers.controls;\n        var controlsContainer = containers.controls; // Legacy option\n\n        var streamContainers = containers.stream;\n        var baseOptions = {\n          session: session,\n          core: accPack,\n          accPack: accPack,\n          controlsContainer: controlsContainer,\n          appendControl: appendControl,\n          streamContainers: streamContainers\n        };\n\n        switch (packageName) {\n          /* beautify ignore:start */\n          case 'communication':\n            {\n              return Object.assign({}, baseOptions, {\n                state: internalState,\n                analytics: analytics\n              }, options.communication);\n            }\n\n          case 'textChat':\n            {\n              var textChatOptions = {\n                textChatContainer: path('textChat.container', options),\n                waitingMessage: path('textChat.waitingMessage', options),\n                sender: {\n                  alias: path('textChat.name', options)\n                },\n                alwaysOpen: path('textChat.alwaysOpen', options)\n              };\n              return Object.assign({}, baseOptions, textChatOptions);\n            }\n\n          case 'screenSharing':\n            {\n              var screenSharingContainer = {\n                screenSharingContainer: streamContainers\n              };\n              return Object.assign({}, baseOptions, screenSharingContainer, options.screenSharing);\n            }\n\n          case 'annotation':\n            {\n              return Object.assign({}, baseOptions, options.annotation);\n            }\n\n          case 'archiving':\n            {\n              return Object.assign({}, baseOptions, options.archiving);\n            }\n\n          default:\n            return {};\n\n          /* beautify ignore:end */\n        }\n      };\n      /** Create instances of each package */\n      // eslint-disable-next-line global-require,import/no-extraneous-dependencies\n\n\n      _this.communication = new Communication(packageOptions('communication'));\n      _this.textChat = packages.TextChat ? new packages.TextChat(packageOptions('textChat')) : null;\n      _this.screenSharing = packages.ScreenSharing ? new packages.ScreenSharing(packageOptions('screenSharing')) : null;\n      _this.annotation = packages.Annotation ? new packages.Annotation(packageOptions('annotation')) : null;\n      _this.archiving = packages.Archiving ? new packages.Archiving(packageOptions('archiving')) : null;\n      analytics.log(logAction.initPackages, logVariation.success);\n    }\n  });\n  Object.defineProperty(this, 'connect', {\n    enumerable: true,\n    writable: true,\n    value: function value() {\n      var analytics = _this.analytics,\n          getSession = _this.getSession,\n          initPackages = _this.initPackages,\n          triggerEvent = _this.triggerEvent,\n          getCredentials = _this.getCredentials;\n      return new Promise(function (resolve, reject) {\n        analytics.log(logAction.connect, logVariation.attempt);\n        var session = getSession();\n\n        var _getCredentials = getCredentials(),\n            token = _getCredentials.token;\n\n        session.connect(token, function (error) {\n          if (error) {\n            message(error);\n            analytics.log(logAction.connect, logVariation.fail);\n            return reject(error);\n          }\n\n          var sessionId = session.sessionId,\n              apiKey = session.apiKey;\n          analytics.update(sessionId, path('connection.connectionId', session), apiKey);\n          analytics.log(logAction.connect, logVariation.success);\n          initPackages();\n          triggerEvent('connected', session);\n          return resolve({\n            connections: session.connections.length()\n          });\n        });\n      });\n    }\n  });\n  Object.defineProperty(this, 'disconnect', {\n    enumerable: true,\n    writable: true,\n    value: function value() {\n      var analytics = _this.analytics,\n          getSession = _this.getSession,\n          internalState = _this.internalState;\n      analytics.log(logAction.disconnect, logVariation.attempt);\n      getSession().disconnect();\n      internalState.reset();\n      analytics.log(logAction.disconnect, logVariation.success);\n    }\n  });\n  Object.defineProperty(this, 'forceDisconnect', {\n    enumerable: true,\n    writable: true,\n    value: function value(connection) {\n      var analytics = _this.analytics,\n          getSession = _this.getSession;\n      return new Promise(function (resolve, reject) {\n        analytics.log(logAction.forceDisconnect, logVariation.attempt);\n        getSession().forceDisconnect(connection, function (error) {\n          if (error) {\n            analytics.log(logAction.forceDisconnect, logVariation.fail);\n            reject(error);\n          } else {\n            analytics.log(logAction.forceDisconnect, logVariation.success);\n            resolve();\n          }\n        });\n      });\n    }\n  });\n  Object.defineProperty(this, 'startCall', {\n    enumerable: true,\n    writable: true,\n    value: function value(publisherProps) {\n      return _this.communication.startCall(publisherProps);\n    }\n  });\n  Object.defineProperty(this, 'endCall', {\n    enumerable: true,\n    writable: true,\n    value: function value() {\n      return _this.communication.endCall();\n    }\n  });\n  Object.defineProperty(this, 'state', {\n    enumerable: true,\n    writable: true,\n    value: function value() {\n      return _this.internalState.all();\n    }\n  });\n  Object.defineProperty(this, 'subscribe', {\n    enumerable: true,\n    writable: true,\n    value: function value(stream, subscriberProperties) {\n      var networkTest = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : false;\n      return _this.communication.subscribe(stream, subscriberProperties, networkTest);\n    }\n  });\n  Object.defineProperty(this, 'unsubscribe', {\n    enumerable: true,\n    writable: true,\n    value: function value(subscriber) {\n      return _this.communication.unsubscribe(subscriber);\n    }\n  });\n  Object.defineProperty(this, 'forceUnpublish', {\n    enumerable: true,\n    writable: true,\n    value: function value(stream) {\n      var analytics = _this.analytics,\n          getSession = _this.getSession;\n      return new Promise(function (resolve, reject) {\n        analytics.log(logAction.forceUnpublish, logVariation.attempt);\n        getSession().forceUnpublish(stream, function (error) {\n          if (error) {\n            analytics.log(logAction.forceUnpublish, logVariation.fail);\n            reject(error);\n          } else {\n            analytics.log(logAction.forceUnpublish, logVariation.success);\n            resolve();\n          }\n        });\n      });\n    }\n  });\n  Object.defineProperty(this, 'getPublisherForStream', {\n    enumerable: true,\n    writable: true,\n    value: function value(stream) {\n      return _this.getSession().getPublisherForStream(stream);\n    }\n  });\n  Object.defineProperty(this, 'getSubscribersForStream', {\n    enumerable: true,\n    writable: true,\n    value: function value(stream) {\n      return _this.getSession().getSubscribersForStream(stream);\n    }\n  });\n  Object.defineProperty(this, 'signal', {\n    enumerable: true,\n    writable: true,\n    value: function value(type, data, to) {\n      var analytics = _this.analytics,\n          getSession = _this.getSession;\n      return new Promise(function (resolve, reject) {\n        analytics.log(logAction.signal, logVariation.attempt);\n        var session = getSession();\n        var signalObj = Object.assign({}, type ? {\n          type: type\n        } : null, data ? {\n          data: JSON.stringify(data)\n        } : null, to ? {\n          to: to\n        } : null // eslint-disable-line comma-dangle\n        );\n        session.signal(signalObj, function (error) {\n          if (error) {\n            analytics.log(logAction.signal, logVariation.fail);\n            reject(error);\n          } else {\n            analytics.log(logAction.signal, logVariation.success);\n            resolve();\n          }\n        });\n      });\n    }\n  });\n  Object.defineProperty(this, 'toggleLocalAudio', {\n    enumerable: true,\n    writable: true,\n    value: function value(enable) {\n      var analytics = _this.analytics,\n          internalState = _this.internalState,\n          communication = _this.communication;\n      analytics.log(logAction.toggleLocalAudio, logVariation.attempt);\n\n      var _internalState$getPub = internalState.getPubSub(),\n          publishers = _internalState$getPub.publishers;\n\n      var toggleAudio = function toggleAudio(id) {\n        return communication.enableLocalAV(id, 'audio', enable);\n      };\n\n      Object.keys(publishers.camera).forEach(toggleAudio);\n      analytics.log(logAction.toggleLocalAudio, logVariation.success);\n    }\n  });\n  Object.defineProperty(this, 'toggleLocalVideo', {\n    enumerable: true,\n    writable: true,\n    value: function value(enable) {\n      var analytics = _this.analytics,\n          internalState = _this.internalState,\n          communication = _this.communication;\n      analytics.log(logAction.toggleLocalVideo, logVariation.attempt);\n\n      var _internalState$getPub2 = internalState.getPubSub(),\n          publishers = _internalState$getPub2.publishers;\n\n      var toggleVideo = function toggleVideo(id) {\n        return communication.enableLocalAV(id, 'video', enable);\n      };\n\n      Object.keys(publishers.camera).forEach(toggleVideo);\n      analytics.log(logAction.toggleLocalVideo, logVariation.success);\n    }\n  });\n  Object.defineProperty(this, 'toggleRemoteAudio', {\n    enumerable: true,\n    writable: true,\n    value: function value(id, enable) {\n      var analytics = _this.analytics,\n          communication = _this.communication;\n      analytics.log(logAction.toggleRemoteAudio, logVariation.attempt);\n      communication.enableRemoteAV(id, 'audio', enable);\n      analytics.log(logAction.toggleRemoteAudio, logVariation.success);\n    }\n  });\n  Object.defineProperty(this, 'toggleRemoteVideo', {\n    enumerable: true,\n    writable: true,\n    value: function value(id, enable) {\n      var analytics = _this.analytics,\n          communication = _this.communication;\n      analytics.log(logAction.toggleRemoteVideo, logVariation.attempt);\n      communication.enableRemoteAV(id, 'video', enable);\n      analytics.log(logAction.toggleRemoteVideo, logVariation.success);\n    }\n  });\n};\n\nif (global === window) {\n  window.AccCore = AccCore;\n}\n\nmodule.exports = AccCore;","map":{"version":3,"sources":["/Users/suryanandsunil/Desktop/proto1-arizon/lyo-test/node_modules/opentok-accelerator-core/dist/core.js"],"names":["_typeof","Symbol","iterator","obj","constructor","prototype","_classCallCheck","instance","Constructor","TypeError","util","require","State","default","accPackEvents","Communication","OpenTokSDK","_require","CoreError","_require2","message","Analytics","logAction","logVariation","dom","path","pathOr","properCase","validateCredentials","credentials","arguments","length","undefined","required","forEach","credential","AccCore","options","_initialiseProps","call","name","applicationName","analytics","window","location","origin","sessionId","apiKey","log","init","attempt","sessionProps","largeScale","connectionEventsSuppressed","session","OT","initSession","internalState","setSession","setCredentials","setOptions","communication","textChat","screenSharing","annotation","archiving","createEventListeners","success","Object","defineProperty","enumerable","writable","value","_this","packageName","getAccPack","packages","events","eventListeners","eventList","Array","isArray","event","Set","callback","on","keys","eventName","eventCallbacks","add","eventType","clear","delete","data","registerEvents","getSession","getCredentials","getOptions","triggerEvent","type","usingAnnotation","internalAnnotation","addStream","stream","removeStream","_ref","subscriber","start","then","absoluteParent","query","linkOptions","linkCanvas","element","parentElement","end","publisher","addPublisher","assign","getPubSub","removePublisher","screensharing","pubSub","annotationContainer","externalWindow","streams","getStreams","cameraStreams","reduce","acc","streamId","videoType","concat","addSubscriberToExternalWindow","setupExternalAnnotation","linkAnnotation","initPackages","optionalRequire","globalName","result","error","fail","availablePackages","acceleratorPack","getDefaultContainer","document","getElementById","getContainerElements","controls","chat","packageOptions","accPack","registerEventListener","containers","appendControl","controlsContainer","streamContainers","baseOptions","core","state","textChatOptions","textChatContainer","waitingMessage","sender","alias","alwaysOpen","screenSharingContainer","TextChat","ScreenSharing","Annotation","Archiving","Promise","resolve","reject","connect","_getCredentials","token","update","connections","disconnect","reset","connection","forceDisconnect","publisherProps","startCall","endCall","all","subscriberProperties","networkTest","subscribe","unsubscribe","forceUnpublish","getPublisherForStream","getSubscribersForStream","to","signal","signalObj","JSON","stringify","enable","toggleLocalAudio","_internalState$getPub","publishers","toggleAudio","id","enableLocalAV","camera","toggleLocalVideo","_internalState$getPub2","toggleVideo","toggleRemoteAudio","enableRemoteAV","toggleRemoteVideo","global","module","exports"],"mappings":"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","sourcesContent":["'use strict';\n\nvar _typeof = typeof Symbol === \"function\" && typeof Symbol.iterator === \"symbol\" ? function (obj) { return typeof obj; } : function (obj) { return obj && typeof Symbol === \"function\" && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj; };\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\n/* global OT */\n/**\n * Dependencies\n */\nvar util = require('./util');\nvar State = require('./state').default;\nvar accPackEvents = require('./events');\nvar Communication = require('./communication').default;\nvar OpenTokSDK = require('./sdk-wrapper/sdkWrapper');\n\nvar _require = require('./errors'),\n    CoreError = _require.CoreError;\n\nvar _require2 = require('./logging'),\n    message = _require2.message,\n    Analytics = _require2.Analytics,\n    logAction = _require2.logAction,\n    logVariation = _require2.logVariation;\n\n/**\n * Helper methods\n */\n\n\nvar dom = util.dom,\n    path = util.path,\n    pathOr = util.pathOr,\n    properCase = util.properCase;\n\n/**\n * Ensure that we have the required credentials\n * @param {Object} credentials\n * @param {String} credentials.apiKey\n * @param {String} credentials.sessionId\n * @param {String} credentials.token\n */\n\nvar validateCredentials = function validateCredentials() {\n  var credentials = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : [];\n\n  var required = ['apiKey', 'sessionId', 'token'];\n  required.forEach(function (credential) {\n    if (!credentials[credential]) {\n      throw new CoreError(credential + ' is a required credential', 'invalidParameters');\n    }\n  });\n};\n\nvar AccCore = function AccCore(options) {\n  _classCallCheck(this, AccCore);\n\n  _initialiseProps.call(this);\n\n  // Options/credentials validation\n  if (!options) {\n    throw new CoreError('Missing options required for initialization', 'invalidParameters');\n  }\n  var credentials = options.credentials;\n\n  validateCredentials(options.credentials);\n  this.name = options.name;\n\n  // Init analytics\n  this.applicationName = options.applicationName;\n  this.analytics = new Analytics(window.location.origin, credentials.sessionId, null, credentials.apiKey);\n  this.analytics.log(logAction.init, logVariation.attempt);\n\n  // Create session, setup state\n  var sessionProps = options.largeScale ? { connectionEventsSuppressed: true } : undefined;\n  this.session = OT.initSession(credentials.apiKey, credentials.sessionId, sessionProps);\n  this.internalState = new State();\n  this.internalState.setSession(this.session);\n  this.internalState.setCredentials(credentials);\n  this.internalState.setOptions(options);\n\n  // Individual accelerator packs\n  this.communication = null;\n  this.textChat = null;\n  this.screenSharing = null;\n  this.annotation = null;\n  this.archiving = null;\n\n  // Create internal event listeners\n  this.createEventListeners(this.session, options);\n\n  this.analytics.log(logAction.init, logVariation.success);\n}\n\n// OpenTok SDK Wrapper\n\n\n// Expose utility methods\n\n\n/**\n * Get access to an accelerator pack\n * @param {String} packageName - textChat, screenSharing, annotation, or archiving\n * @returns {Object} The instance of the accelerator pack\n */\n\n\n/** Eventing */\n\n/**\n * Register events that can be listened to be other components/modules\n * @param {array | string} events - A list of event names. A single event may\n * also be passed as a string.\n */\n\n\n/**\n * Register a callback for a specific event or pass an object with\n * with event => callback key/value pairs to register listeners for\n * multiple events.\n * @param {String | Object} event - The name of the event\n * @param {Function} callback\n */\n\n\n/**\n * Remove a callback for a specific event.  If no parameters are passed,\n * all event listeners will be removed.\n * @param {String} event - The name of the event\n * @param {Function} callback\n */\n\n\n/**\n * Trigger an event and fire all registered callbacks\n * @param {String} event - The name of the event\n * @param {*} data - Data to be passed to callback functions\n */\n\n\n/**\n * Get the current OpenTok session object\n * @returns {Object}\n */\n\n\n/**\n * Returns the current OpenTok session credentials\n * @returns {Object}\n */\n\n\n/**\n * Returns the options used for initialization\n * @returns {Object}\n */\n\n\n/**\n * Connect to the session\n * @returns {Promise} <resolve: -, reject: Error>\n */\n\n\n/**\n * Disconnect from the session\n * @returns {Promise} <resolve: -, reject: Error>\n */\n\n\n/**\n * Force a remote connection to leave the session\n * @param {Object} connection\n * @returns {Promise} <resolve: empty, reject: Error>\n */\n\n\n/**\n * Start publishing video and subscribing to streams\n * @param {Object} publisherProps - https://goo.gl/0mL0Eo\n * @returns {Promise} <resolve: State + Publisher, reject: Error>\n */\n\n\n/**\n * Stop all publishing un unsubscribe from all streams\n * @returns {void}\n */\n\n\n/**\n * Start publishing video and subscribing to streams\n * @returns {Object} The internal state of the core session\n */\n\n\n/**\n * Manually subscribe to a stream\n * @param {Object} stream - An OpenTok stream\n * @param {Object} [subscriberProperties] - https://tokbox.com/developer/sdks/js/reference/Session.html#subscribe\n * @param {Boolean} [networkTest] - Subscribing to our own publisher as part of a network test?\n * @returns {Promise} <resolve: Subscriber, reject: Error>\n */\n\n\n/**\n * Manually unsubscribe from a stream\n * @param {Object} subscriber - An OpenTok subscriber object\n * @returns {Promise} <resolve: void, reject: Error>\n */\n\n\n/**\n * Force the publisher of a stream to stop publishing the stream\n * @param {Object} stream\n * @returns {Promise} <resolve: empty, reject: Error>\n */\n\n\n/**\n * Get the local publisher object for a stream\n * @param {Object} stream - An OpenTok stream object\n * @returns {Object} - The publisher object\n */\n\n\n/**\n * Get the local subscriber objects for a stream\n * @param {Object} stream - An OpenTok stream object\n * @returns {Array} - An array of subscriber object\n */\n\n\n/**\n * Send a signal using the OpenTok signaling apiKey\n * @param {String} type\n * @param {*} [data]\n * @param {Object} [to] - An OpenTok connection object\n * @returns {Promise} <resolve: empty, reject: Error>\n */\n\n\n/**\n * Enable or disable local audio\n * @param {Boolean} enable\n */\n\n\n/**\n * Enable or disable local video\n * @param {Boolean} enable\n */\n\n\n/**\n * Enable or disable remote audio\n * @param {String} id - Subscriber id\n * @param {Boolean} enable\n */\n\n\n/**\n * Enable or disable remote video\n * @param {String} id - Subscriber id\n * @param {Boolean} enable\n */\n;\n\nObject.defineProperty(AccCore, 'OpenTokSDK', {\n  enumerable: true,\n  writable: true,\n  value: OpenTokSDK\n});\nObject.defineProperty(AccCore, 'util', {\n  enumerable: true,\n  writable: true,\n  value: util\n});\n\nvar _initialiseProps = function _initialiseProps() {\n  var _this = this;\n\n  Object.defineProperty(this, 'getAccPack', {\n    enumerable: true,\n    writable: true,\n    value: function value(packageName) {\n      var analytics = _this.analytics,\n          textChat = _this.textChat,\n          screenSharing = _this.screenSharing,\n          annotation = _this.annotation,\n          archiving = _this.archiving;\n\n      analytics.log(logAction.getAccPack, logVariation.attempt);\n      var packages = {\n        textChat: textChat,\n        screenSharing: screenSharing,\n        annotation: annotation,\n        archiving: archiving\n      };\n      analytics.log(logAction.getAccPack, logVariation.success);\n      return packages[packageName];\n    }\n  });\n  Object.defineProperty(this, 'registerEvents', {\n    enumerable: true,\n    writable: true,\n    value: function value(events) {\n      var eventListeners = _this.eventListeners;\n\n      var eventList = Array.isArray(events) ? events : [events];\n      eventList.forEach(function (event) {\n        if (!eventListeners[event]) {\n          eventListeners[event] = new Set();\n        }\n      });\n    }\n  });\n  Object.defineProperty(this, 'on', {\n    enumerable: true,\n    writable: true,\n    value: function value(event, callback) {\n      var eventListeners = _this.eventListeners,\n          on = _this.on;\n      // analytics.log(logAction.on, logVariation.attempt);\n\n      if ((typeof event === 'undefined' ? 'undefined' : _typeof(event)) === 'object') {\n        Object.keys(event).forEach(function (eventName) {\n          on(eventName, event[eventName]);\n        });\n        return;\n      }\n      var eventCallbacks = eventListeners[event];\n      if (!eventCallbacks) {\n        message(event + ' is not a registered event.');\n        // analytics.log(logAction.on, logVariation.fail);\n      } else {\n        eventCallbacks.add(callback);\n        // analytics.log(logAction.on, logVariation.success);\n      }\n    }\n  });\n  Object.defineProperty(this, 'off', {\n    enumerable: true,\n    writable: true,\n    value: function value(event, callback) {\n      var eventListeners = _this.eventListeners;\n      // analytics.log(logAction.off, logVariation.attempt);\n\n      if (!event && !callback) {\n        Object.keys(eventListeners).forEach(function (eventType) {\n          eventListeners[eventType].clear();\n        });\n      } else {\n        var eventCallbacks = eventListeners[event];\n        if (!eventCallbacks) {\n          // analytics.log(logAction.off, logVariation.fail);\n          message(event + ' is not a registered event.');\n        } else {\n          eventCallbacks.delete(callback);\n          // analytics.log(logAction.off, logVariation.success);\n        }\n      }\n    }\n  });\n  Object.defineProperty(this, 'triggerEvent', {\n    enumerable: true,\n    writable: true,\n    value: function value(event, data) {\n      var eventListeners = _this.eventListeners,\n          registerEvents = _this.registerEvents;\n\n      var eventCallbacks = eventListeners[event];\n      if (!eventCallbacks) {\n        registerEvents(event);\n        message(event + ' has been registered as a new event.');\n      } else {\n        eventCallbacks.forEach(function (callback) {\n          return callback(data, event);\n        });\n      }\n    }\n  });\n  Object.defineProperty(this, 'getSession', {\n    enumerable: true,\n    writable: true,\n    value: function value() {\n      return _this.internalState.getSession();\n    }\n  });\n  Object.defineProperty(this, 'getCredentials', {\n    enumerable: true,\n    writable: true,\n    value: function value() {\n      return _this.internalState.getCredentials();\n    }\n  });\n  Object.defineProperty(this, 'getOptions', {\n    enumerable: true,\n    writable: true,\n    value: function value() {\n      return _this.internalState.getOptions();\n    }\n  });\n  Object.defineProperty(this, 'createEventListeners', {\n    enumerable: true,\n    writable: true,\n    value: function value(session, options) {\n      _this.eventListeners = {};\n      var registerEvents = _this.registerEvents,\n          internalState = _this.internalState,\n          triggerEvent = _this.triggerEvent,\n          on = _this.on,\n          getSession = _this.getSession;\n\n      Object.keys(accPackEvents).forEach(function (type) {\n        return registerEvents(accPackEvents[type]);\n      });\n\n      /**\n       * If using screen sharing + annotation in an external window, the screen sharing\n       * package will take care of calling annotation.start() and annotation.linkCanvas()\n       */\n      var usingAnnotation = path('screenSharing.annotation', options);\n      var internalAnnotation = usingAnnotation && !path('screenSharing.externalWindow', options);\n\n      /**\n       * Wrap session events and update internalState when streams are created\n       * or destroyed\n       */\n      accPackEvents.session.forEach(function (eventName) {\n        session.on(eventName, function (event) {\n          if (eventName === 'streamCreated') {\n            internalState.addStream(event.stream);\n          }\n          if (eventName === 'streamDestroyed') {\n            internalState.removeStream(event.stream);\n          }\n          triggerEvent(eventName, event);\n        });\n      });\n\n      if (usingAnnotation) {\n        on('subscribeToScreen', function (_ref) {\n          var subscriber = _ref.subscriber;\n\n          _this.annotation.start(getSession()).then(function () {\n            var absoluteParent = dom.query(path('annotation.absoluteParent.subscriber', options));\n            var linkOptions = absoluteParent ? { absoluteParent: absoluteParent } : null;\n            _this.annotation.linkCanvas(subscriber, subscriber.element.parentElement, linkOptions);\n          });\n        });\n\n        on('unsubscribeFromScreen', function () {\n          _this.annotation.end();\n        });\n      }\n\n      on('startScreenSharing', function (publisher) {\n        internalState.addPublisher('screen', publisher);\n        triggerEvent('startScreenShare', Object.assign({}, { publisher: publisher }, internalState.getPubSub()));\n        if (internalAnnotation) {\n          _this.annotation.start(getSession()).then(function () {\n            var absoluteParent = dom.query(path('annotation.absoluteParent.publisher', options));\n            var linkOptions = absoluteParent ? { absoluteParent: absoluteParent } : null;\n            _this.annotation.linkCanvas(publisher, publisher.element.parentElement, linkOptions);\n          });\n        }\n      });\n\n      on('endScreenSharing', function (publisher) {\n        // delete publishers.screen[publisher.id];\n        internalState.removePublisher('screen', publisher);\n        triggerEvent('endScreenShare', internalState.getPubSub());\n        if (usingAnnotation) {\n          _this.annotation.end();\n        }\n      });\n    }\n  });\n  Object.defineProperty(this, 'setupExternalAnnotation', {\n    enumerable: true,\n    writable: true,\n    value: function value() {\n      return _this.annotation.start(_this.getSession(), { screensharing: true });\n    }\n  });\n  Object.defineProperty(this, 'linkAnnotation', {\n    enumerable: true,\n    writable: true,\n    value: function value(pubSub, annotationContainer, externalWindow) {\n      var annotation = _this.annotation,\n          internalState = _this.internalState;\n\n      annotation.linkCanvas(pubSub, annotationContainer, {\n        externalWindow: externalWindow\n      });\n\n      if (externalWindow) {\n        // Add subscribers to the external window\n        var streams = internalState.getStreams();\n        var cameraStreams = Object.keys(streams).reduce(function (acc, streamId) {\n          var stream = streams[streamId];\n          return stream.videoType === 'camera' || stream.videoType === 'sip' ? acc.concat(stream) : acc;\n        }, []);\n        cameraStreams.forEach(annotation.addSubscriberToExternalWindow);\n      }\n    }\n  });\n  Object.defineProperty(this, 'initPackages', {\n    enumerable: true,\n    writable: true,\n    value: function value() {\n      var analytics = _this.analytics,\n          getSession = _this.getSession,\n          getOptions = _this.getOptions,\n          internalState = _this.internalState;\n      var on = _this.on,\n          registerEvents = _this.registerEvents,\n          setupExternalAnnotation = _this.setupExternalAnnotation,\n          triggerEvent = _this.triggerEvent,\n          linkAnnotation = _this.linkAnnotation;\n\n      analytics.log(logAction.initPackages, logVariation.attempt);\n      var session = getSession();\n      var options = getOptions();\n      /**\n       * Try to require a package.  If 'require' is unavailable, look for\n       * the package in global scope.  A switch ttatement is used because\n       * webpack and Browserify aren't able to resolve require statements\n       * that use variable names.\n       * @param {String} packageName - The name of the npm package\n       * @param {String} globalName - The name of the package if exposed on global/window\n       * @returns {Object}\n       */\n      var optionalRequire = function optionalRequire(packageName, globalName) {\n        var result = void 0;\n        /* eslint-disable global-require, import/no-extraneous-dependencies, import/no-unresolved */\n        try {\n          switch (packageName) {\n            case 'opentok-text-chat':\n              result = require('opentok-text-chat');\n              break;\n            case 'opentok-screen-sharing':\n              result = require('opentok-screen-sharing');\n              break;\n            case 'opentok-annotation':\n              result = require('opentok-annotation');\n              break;\n            case 'opentok-archiving':\n              result = require('opentok-archiving');\n              break;\n            default:\n              break;\n          }\n          /* eslint-enable global-require */\n        } catch (error) {\n          result = window[globalName];\n        }\n        if (!result) {\n          analytics.log(logAction.initPackages, logVariation.fail);\n          throw new CoreError('Could not load ' + packageName, 'missingDependency');\n        }\n        return result;\n      };\n\n      var availablePackages = {\n        textChat: function textChat() {\n          return optionalRequire('opentok-text-chat', 'TextChatAccPack');\n        },\n        screenSharing: function screenSharing() {\n          return optionalRequire('opentok-screen-sharing', 'ScreenSharingAccPack');\n        },\n        annotation: function annotation() {\n          return optionalRequire('opentok-annotation', 'AnnotationAccPack');\n        },\n        archiving: function archiving() {\n          return optionalRequire('opentok-archiving', 'ArchivingAccPack');\n        }\n      };\n\n      var packages = {};\n      (path('packages', options) || []).forEach(function (acceleratorPack) {\n        if (availablePackages[acceleratorPack]) {\n          // eslint-disable-next-line no-param-reassign\n          packages[properCase(acceleratorPack)] = availablePackages[acceleratorPack]();\n        } else {\n          message(acceleratorPack + ' is not a valid accelerator pack');\n        }\n      });\n\n      /**\n       * Get containers for streams, controls, and the chat widget\n       */\n      var getDefaultContainer = function getDefaultContainer(pubSub) {\n        return document.getElementById(pubSub + 'Container');\n      };\n      var getContainerElements = function getContainerElements() {\n        // Need to use path to check for null values\n        var controls = pathOr('#videoControls', 'controlsContainer', options);\n        var chat = pathOr('#chat', 'textChat.container', options);\n        var stream = pathOr(getDefaultContainer, 'streamContainers', options);\n        return { stream: stream, controls: controls, chat: chat };\n      };\n      /** *** *** *** *** */\n\n      /**\n       * Return options for the specified package\n       * @param {String} packageName\n       * @returns {Object}\n       */\n      var packageOptions = function packageOptions(packageName) {\n        /**\n         * Methods to expose to accelerator packs\n         */\n        var accPack = {\n          registerEventListener: on, // Legacy option\n          on: on,\n          registerEvents: registerEvents,\n          triggerEvent: triggerEvent,\n          setupExternalAnnotation: setupExternalAnnotation,\n          linkAnnotation: linkAnnotation\n        };\n\n        /**\n         * If options.controlsContainer/containers.controls is null,\n         * accelerator packs should not append their controls.\n         */\n        var containers = getContainerElements();\n        var appendControl = !!containers.controls;\n        var controlsContainer = containers.controls; // Legacy option\n        var streamContainers = containers.stream;\n        var baseOptions = {\n          session: session,\n          core: accPack,\n          accPack: accPack,\n          controlsContainer: controlsContainer,\n          appendControl: appendControl,\n          streamContainers: streamContainers\n        };\n\n        switch (packageName) {\n          /* beautify ignore:start */\n          case 'communication':\n            {\n              return Object.assign({}, baseOptions, { state: internalState, analytics: analytics }, options.communication);\n            }\n          case 'textChat':\n            {\n              var textChatOptions = {\n                textChatContainer: path('textChat.container', options),\n                waitingMessage: path('textChat.waitingMessage', options),\n                sender: { alias: path('textChat.name', options) },\n                alwaysOpen: path('textChat.alwaysOpen', options)\n              };\n              return Object.assign({}, baseOptions, textChatOptions);\n            }\n          case 'screenSharing':\n            {\n              var screenSharingContainer = { screenSharingContainer: streamContainers };\n              return Object.assign({}, baseOptions, screenSharingContainer, options.screenSharing);\n            }\n          case 'annotation':\n            {\n              return Object.assign({}, baseOptions, options.annotation);\n            }\n          case 'archiving':\n            {\n              return Object.assign({}, baseOptions, options.archiving);\n            }\n          default:\n            return {};\n          /* beautify ignore:end */\n        }\n      };\n\n      /** Create instances of each package */\n      // eslint-disable-next-line global-require,import/no-extraneous-dependencies\n\n      _this.communication = new Communication(packageOptions('communication'));\n      _this.textChat = packages.TextChat ? new packages.TextChat(packageOptions('textChat')) : null;\n      _this.screenSharing = packages.ScreenSharing ? new packages.ScreenSharing(packageOptions('screenSharing')) : null;\n      _this.annotation = packages.Annotation ? new packages.Annotation(packageOptions('annotation')) : null;\n      _this.archiving = packages.Archiving ? new packages.Archiving(packageOptions('archiving')) : null;\n\n      analytics.log(logAction.initPackages, logVariation.success);\n    }\n  });\n  Object.defineProperty(this, 'connect', {\n    enumerable: true,\n    writable: true,\n    value: function value() {\n      var analytics = _this.analytics,\n          getSession = _this.getSession,\n          initPackages = _this.initPackages,\n          triggerEvent = _this.triggerEvent,\n          getCredentials = _this.getCredentials;\n\n      return new Promise(function (resolve, reject) {\n        analytics.log(logAction.connect, logVariation.attempt);\n        var session = getSession();\n\n        var _getCredentials = getCredentials(),\n            token = _getCredentials.token;\n\n        session.connect(token, function (error) {\n          if (error) {\n            message(error);\n            analytics.log(logAction.connect, logVariation.fail);\n            return reject(error);\n          }\n          var sessionId = session.sessionId,\n              apiKey = session.apiKey;\n\n          analytics.update(sessionId, path('connection.connectionId', session), apiKey);\n          analytics.log(logAction.connect, logVariation.success);\n          initPackages();\n          triggerEvent('connected', session);\n          return resolve({ connections: session.connections.length() });\n        });\n      });\n    }\n  });\n  Object.defineProperty(this, 'disconnect', {\n    enumerable: true,\n    writable: true,\n    value: function value() {\n      var analytics = _this.analytics,\n          getSession = _this.getSession,\n          internalState = _this.internalState;\n\n      analytics.log(logAction.disconnect, logVariation.attempt);\n      getSession().disconnect();\n      internalState.reset();\n      analytics.log(logAction.disconnect, logVariation.success);\n    }\n  });\n  Object.defineProperty(this, 'forceDisconnect', {\n    enumerable: true,\n    writable: true,\n    value: function value(connection) {\n      var analytics = _this.analytics,\n          getSession = _this.getSession;\n\n      return new Promise(function (resolve, reject) {\n        analytics.log(logAction.forceDisconnect, logVariation.attempt);\n        getSession().forceDisconnect(connection, function (error) {\n          if (error) {\n            analytics.log(logAction.forceDisconnect, logVariation.fail);\n            reject(error);\n          } else {\n            analytics.log(logAction.forceDisconnect, logVariation.success);\n            resolve();\n          }\n        });\n      });\n    }\n  });\n  Object.defineProperty(this, 'startCall', {\n    enumerable: true,\n    writable: true,\n    value: function value(publisherProps) {\n      return _this.communication.startCall(publisherProps);\n    }\n  });\n  Object.defineProperty(this, 'endCall', {\n    enumerable: true,\n    writable: true,\n    value: function value() {\n      return _this.communication.endCall();\n    }\n  });\n  Object.defineProperty(this, 'state', {\n    enumerable: true,\n    writable: true,\n    value: function value() {\n      return _this.internalState.all();\n    }\n  });\n  Object.defineProperty(this, 'subscribe', {\n    enumerable: true,\n    writable: true,\n    value: function value(stream, subscriberProperties) {\n      var networkTest = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : false;\n      return _this.communication.subscribe(stream, subscriberProperties, networkTest);\n    }\n  });\n  Object.defineProperty(this, 'unsubscribe', {\n    enumerable: true,\n    writable: true,\n    value: function value(subscriber) {\n      return _this.communication.unsubscribe(subscriber);\n    }\n  });\n  Object.defineProperty(this, 'forceUnpublish', {\n    enumerable: true,\n    writable: true,\n    value: function value(stream) {\n      var analytics = _this.analytics,\n          getSession = _this.getSession;\n\n      return new Promise(function (resolve, reject) {\n        analytics.log(logAction.forceUnpublish, logVariation.attempt);\n        getSession().forceUnpublish(stream, function (error) {\n          if (error) {\n            analytics.log(logAction.forceUnpublish, logVariation.fail);\n            reject(error);\n          } else {\n            analytics.log(logAction.forceUnpublish, logVariation.success);\n            resolve();\n          }\n        });\n      });\n    }\n  });\n  Object.defineProperty(this, 'getPublisherForStream', {\n    enumerable: true,\n    writable: true,\n    value: function value(stream) {\n      return _this.getSession().getPublisherForStream(stream);\n    }\n  });\n  Object.defineProperty(this, 'getSubscribersForStream', {\n    enumerable: true,\n    writable: true,\n    value: function value(stream) {\n      return _this.getSession().getSubscribersForStream(stream);\n    }\n  });\n  Object.defineProperty(this, 'signal', {\n    enumerable: true,\n    writable: true,\n    value: function value(type, data, to) {\n      var analytics = _this.analytics,\n          getSession = _this.getSession;\n\n      return new Promise(function (resolve, reject) {\n        analytics.log(logAction.signal, logVariation.attempt);\n        var session = getSession();\n        var signalObj = Object.assign({}, type ? { type: type } : null, data ? { data: JSON.stringify(data) } : null, to ? { to: to } : null // eslint-disable-line comma-dangle\n        );\n        session.signal(signalObj, function (error) {\n          if (error) {\n            analytics.log(logAction.signal, logVariation.fail);\n            reject(error);\n          } else {\n            analytics.log(logAction.signal, logVariation.success);\n            resolve();\n          }\n        });\n      });\n    }\n  });\n  Object.defineProperty(this, 'toggleLocalAudio', {\n    enumerable: true,\n    writable: true,\n    value: function value(enable) {\n      var analytics = _this.analytics,\n          internalState = _this.internalState,\n          communication = _this.communication;\n\n      analytics.log(logAction.toggleLocalAudio, logVariation.attempt);\n\n      var _internalState$getPub = internalState.getPubSub(),\n          publishers = _internalState$getPub.publishers;\n\n      var toggleAudio = function toggleAudio(id) {\n        return communication.enableLocalAV(id, 'audio', enable);\n      };\n      Object.keys(publishers.camera).forEach(toggleAudio);\n      analytics.log(logAction.toggleLocalAudio, logVariation.success);\n    }\n  });\n  Object.defineProperty(this, 'toggleLocalVideo', {\n    enumerable: true,\n    writable: true,\n    value: function value(enable) {\n      var analytics = _this.analytics,\n          internalState = _this.internalState,\n          communication = _this.communication;\n\n      analytics.log(logAction.toggleLocalVideo, logVariation.attempt);\n\n      var _internalState$getPub2 = internalState.getPubSub(),\n          publishers = _internalState$getPub2.publishers;\n\n      var toggleVideo = function toggleVideo(id) {\n        return communication.enableLocalAV(id, 'video', enable);\n      };\n      Object.keys(publishers.camera).forEach(toggleVideo);\n      analytics.log(logAction.toggleLocalVideo, logVariation.success);\n    }\n  });\n  Object.defineProperty(this, 'toggleRemoteAudio', {\n    enumerable: true,\n    writable: true,\n    value: function value(id, enable) {\n      var analytics = _this.analytics,\n          communication = _this.communication;\n\n      analytics.log(logAction.toggleRemoteAudio, logVariation.attempt);\n      communication.enableRemoteAV(id, 'audio', enable);\n      analytics.log(logAction.toggleRemoteAudio, logVariation.success);\n    }\n  });\n  Object.defineProperty(this, 'toggleRemoteVideo', {\n    enumerable: true,\n    writable: true,\n    value: function value(id, enable) {\n      var analytics = _this.analytics,\n          communication = _this.communication;\n\n      analytics.log(logAction.toggleRemoteVideo, logVariation.attempt);\n      communication.enableRemoteAV(id, 'video', enable);\n      analytics.log(logAction.toggleRemoteVideo, logVariation.success);\n    }\n  });\n};\n\nif (global === window) {\n  window.AccCore = AccCore;\n}\n\nmodule.exports = AccCore;"]},"metadata":{},"sourceType":"script"}