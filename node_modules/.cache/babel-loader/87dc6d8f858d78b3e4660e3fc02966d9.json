{"ast":null,"code":"import _regeneratorRuntime from\"/Users/suryanandsunil/Desktop/proto1-arizon/lyo-test/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/Users/suryanandsunil/Desktop/proto1-arizon/lyo-test/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"/Users/suryanandsunil/Desktop/proto1-arizon/lyo-test/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import{Box,Button,Card,CardContent,CardHeader,Divider,Grid,TextField,makeStyles,Container,Typography,CardActions,Avatar,InputLabel}from'@material-ui/core';import React,{useEffect,useState}from'react';import{db,storageRef}from'../../firebase';import{firebaseLooper}from'../../utils/tools';import{useAuth}from'../context/AuthContext';import{Link,useHistory}from\"react-router-dom\";import{Alert}from'@material-ui/lab';import{useStorage}from'../../utils/useStorage';import Page from'../Page';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var useStyles=makeStyles(function(){return{root:{},avatar:{height:100,width:100}};});var AccountDetails=function AccountDetails(){var _useAuth=useAuth(),currentUser=_useAuth.currentUser,updatePassword=_useAuth.updatePassword,updateEmail=_useAuth.updateEmail;var _useState=useState(\"\"),_useState2=_slicedToArray(_useState,2),error=_useState2[0],setError=_useState2[1];var _useState3=useState([]),_useState4=_slicedToArray(_useState3,2),account=_useState4[0],setAccount=_useState4[1];var _useState5=useState(false),_useState6=_slicedToArray(_useState5,2),loading=_useState6[0],setLoading=_useState6[1];var _useState7=useState(\"\"),_useState8=_slicedToArray(_useState7,2),message=_useState8[0],setMessage=_useState8[1];var _useState9=useState(\"\"),_useState10=_slicedToArray(_useState9,2),email=_useState10[0],setEmail=_useState10[1];var _useState11=useState(\"\"),_useState12=_slicedToArray(_useState11,2),password=_useState12[0],setPassword=_useState12[1];var _useState13=useState(null),_useState14=_slicedToArray(_useState13,2),file=_useState14[0],setFile=_useState14[1];var _useState15=useState(),_useState16=_slicedToArray(_useState15,2),id=_useState16[0],setId=_useState16[1];var _useState17=useState(true),_useState18=_slicedToArray(_useState17,2),disabled=_useState18[0],setDisabled=_useState18[1];var _useState19=useState(\"\"),_useState20=_slicedToArray(_useState19,2),passwordConfirm=_useState20[0],setPasswordConfirm=_useState20[1];var classes=useStyles();var history=useHistory();var types=[\"image/png\",\"image/jpeg\",\"image/jpg\"];useEffect(function(){db.collection('users').where('email','==',currentUser.email).get().then(function(snapshot){var accountData=firebaseLooper(snapshot);setAccount(accountData[0]);setId(accountData[0].id);});});var handleChange=function handleChange(e){var selectedFile=e.target.files[0];if(selectedFile){if(types.includes(selectedFile.type)){setError(null);setFile(selectedFile);}else{setFile(null);setError(\"Please select an image file (png or jpg)\");setDisabled(true);}}};var _useStorage=useStorage(file),progress=_useStorage.progress,url=_useStorage.url;var _useState21=useState(url),_useState22=_slicedToArray(_useState21,2),link=_useState22[0],setLink=_useState22[1];function handleSubmit(_x){return _handleSubmit.apply(this,arguments);}function _handleSubmit(){_handleSubmit=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(e){return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:e.preventDefault();if(!(password!==passwordConfirm)){_context.next=3;break;}return _context.abrupt(\"return\",setError(\"Passwords do not match! Please try again\"));case 3:if(!(password.length<6)){_context.next=5;break;}return _context.abrupt(\"return\",setError(\"Weak Password ! Passwords should be 6 characters\"));case 5:if(email!==currentUser.email){updateEmail(email);}setLoading(true);setError(\"\");db.collection('users').doc(id).update({password:password});_context.prev=9;_context.next=12;return updatePassword(password);case 12:setMessage(\"Password updated successfully !\");_context.next=18;break;case 15:_context.prev=15;_context.t0=_context[\"catch\"](9);setError(\"Failed to Update Password! Please try again\");case 18:case\"end\":return _context.stop();}}},_callee,null,[[9,15]]);}));return _handleSubmit.apply(this,arguments);}var handleUpload=function handleUpload(){var reqData={url:url};db.collection('users').doc(id).update(reqData).then(function(data){console.log(data);});};return/*#__PURE__*/_jsx(Page,{title:\"Account | LyoIms\",children:/*#__PURE__*/_jsxs(Container,{maxWidth:false,style:{marginTop:'3%',marginBottom:'3%'},children:[/*#__PURE__*/_jsxs(\"div\",{style:{display:'flex',justifyContent:'center'},children:[error&&/*#__PURE__*/_jsx(Alert,{severity:\"error\",children:error}),message&&/*#__PURE__*/_jsx(Alert,{severity:\"success\",children:message})]}),/*#__PURE__*/_jsxs(\"div\",{style:{display:'flex',justifyContent:'space-between'},children:[/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(Typography,{variant:\"h1\",children:/*#__PURE__*/_jsx(\"b\",{children:\"Account Details\"})}),/*#__PURE__*/_jsx(Typography,{variant:\"h5\",children:\"Edit the data you want! \"})]}),/*#__PURE__*/_jsx(\"hr\",{})]}),/*#__PURE__*/_jsx(\"br\",{}),/*#__PURE__*/_jsxs(Grid,{container:true,spacing:3,children:[/*#__PURE__*/_jsxs(Grid,{item:true,lg:6,sm:12,xl:3,xs:12,children:[/*#__PURE__*/_jsxs(Card,{children:[/*#__PURE__*/_jsx(CardContent,{children:/*#__PURE__*/_jsxs(Box,{alignItems:\"center\",display:\"flex\",flexDirection:\"column\",children:[/*#__PURE__*/_jsx(Avatar,{className:classes.avatar,src:account.url}),/*#__PURE__*/_jsx(Typography,{color:\"textPrimary\",gutterBottom:true,variant:\"h3\",children:\" \".concat(account.firstName,\" \").concat(account.lastName)}),/*#__PURE__*/_jsx(Typography,{color:\"textSecondary\",variant:\"body1\",children:account.role})]})}),/*#__PURE__*/_jsx(Divider,{}),/*#__PURE__*/_jsxs(CardActions,{style:{display:'flex',justifyContent:'space-evenly'},children:[/*#__PURE__*/_jsx(\"input\",{type:\"file\",onChange:handleChange}),/*#__PURE__*/_jsx(Button,{disabled:progress<100,variant:\"outlined\",color:\"primary\",onClick:handleUpload,children:\"Upload\"})]})]}),/*#__PURE__*/_jsx(Grid,{children:file&&/*#__PURE__*/_jsxs(\"p\",{children:[progress,\"% uploaded\"]})})]}),/*#__PURE__*/_jsx(Grid,{item:true,lg:6,sm:12,xl:3,xs:12,children:/*#__PURE__*/_jsx(\"form\",{className:classes.root,onSubmit:handleSubmit,children:/*#__PURE__*/_jsxs(Card,{children:[/*#__PURE__*/_jsx(CardHeader,{subheader:\"The information can be edited\",title:\"Profile\"}),/*#__PURE__*/_jsx(Divider,{}),/*#__PURE__*/_jsxs(CardContent,{children:[/*#__PURE__*/_jsx(TextField,{fullWidth:true,label:\"Email Address\",name:\"email\",required:true,value:currentUser.email,variant:\"outlined\",style:{marginBottom:\"5%\"},onChange:function onChange(e){return setEmail(e.target.value);}}),/*#__PURE__*/_jsx(TextField,{fullWidth:true,label:\"Password\",helperText:\"Create a new password for the account!\",value:password,required:true,type:\"password\",variant:\"outlined\",style:{marginBottom:\"5%\"},onChange:function onChange(e){return setPassword(e.target.value);}}),/*#__PURE__*/_jsx(TextField,{fullWidth:true,label:\"Re-enter Password\",value:passwordConfirm,type:\"password\",required:true,style:{marginBottom:\"5%\"},variant:\"outlined\",onChange:function onChange(e){return setPasswordConfirm(e.target.value);}})]}),/*#__PURE__*/_jsx(Divider,{}),/*#__PURE__*/_jsxs(Box,{display:\"flex\",justifyContent:\"flex-end\",p:2,children:[/*#__PURE__*/_jsx(Button,{type:\"submit\",style:{backgroundImage:'linear-gradient(to left bottom, #420ffa, #004dff, #006eff, #238aff, #59a3ff)',color:'white'},variant:\"contained\",onClick:handleSubmit,children:\"Save details\"}),/*#__PURE__*/_jsx(Button,{style:{backgroundImage:' linear-gradient(to right top, #fa0f0f, #fb3434, #f84d50, #f36268, #ea757e)',width:\"100px\",marginLeft:\"5%\"},color:\"secondary\",variant:\"contained\",href:\"/\",children:\"Cancel\"})]})]})})})]})]})});};export default AccountDetails;","map":{"version":3,"sources":["/Users/suryanandsunil/Desktop/proto1-arizon/lyo-test/src/components/Account/AccountDetails.jsx"],"names":["Box","Button","Card","CardContent","CardHeader","Divider","Grid","TextField","makeStyles","Container","Typography","CardActions","Avatar","InputLabel","React","useEffect","useState","db","storageRef","firebaseLooper","useAuth","Link","useHistory","Alert","useStorage","Page","useStyles","root","avatar","height","width","AccountDetails","currentUser","updatePassword","updateEmail","error","setError","account","setAccount","loading","setLoading","message","setMessage","email","setEmail","password","setPassword","file","setFile","id","setId","disabled","setDisabled","passwordConfirm","setPasswordConfirm","classes","history","types","collection","where","get","then","snapshot","accountData","handleChange","e","selectedFile","target","files","includes","type","progress","url","link","setLink","handleSubmit","preventDefault","length","doc","update","handleUpload","reqData","data","console","log","marginTop","marginBottom","display","justifyContent","firstName","lastName","role","value","backgroundImage","color","marginLeft"],"mappings":"8fAAA,OACEA,GADF,CAEEC,MAFF,CAGEC,IAHF,CAIEC,WAJF,CAKEC,UALF,CAMEC,OANF,CAOEC,IAPF,CAQEC,SARF,CASEC,UATF,CAUEC,SAVF,CAWEC,UAXF,CAYEC,WAZF,CAaEC,MAbF,CAcEC,UAdF,KAeO,mBAfP,CAgBA,MAAOC,CAAAA,KAAP,EAAgBC,SAAhB,CAA2BC,QAA3B,KAA2C,OAA3C,CACA,OAASC,EAAT,CAAaC,UAAb,KAA+B,gBAA/B,CACA,OAASC,cAAT,KAA+B,mBAA/B,CACA,OAASC,OAAT,KAAwB,wBAAxB,CACA,OAASC,IAAT,CAAeC,UAAf,KAAiC,kBAAjC,CACA,OAASC,KAAT,KAAsB,kBAAtB,CACA,OAASC,UAAT,KAA2B,wBAA3B,CACA,MAAOC,CAAAA,IAAP,KAAiB,SAAjB,C,wFAEA,GAAMC,CAAAA,SAAS,CAAGlB,UAAU,CAAC,iBAAO,CAClCmB,IAAI,CAAE,EAD4B,CAKlCC,MAAM,CAAE,CACNC,MAAM,CAAE,GADF,CAENC,KAAK,CAAE,GAFD,CAL0B,CAAP,EAAD,CAA5B,CAWA,GAAMC,CAAAA,cAAc,CAAG,QAAjBA,CAAAA,cAAiB,EAAM,cAE2BX,OAAO,EAFlC,CAElBY,WAFkB,UAElBA,WAFkB,CAELC,cAFK,UAELA,cAFK,CAEWC,WAFX,UAEWA,WAFX,eAGDlB,QAAQ,CAAC,EAAD,CAHP,wCAGpBmB,KAHoB,eAGbC,QAHa,8BAIKpB,QAAQ,CAAC,EAAD,CAJb,yCAIlBqB,OAJkB,eAITC,UAJS,8BAKMtB,QAAQ,CAAC,KAAD,CALd,yCAKjBuB,OALiB,eAKRC,UALQ,8BAMMxB,QAAQ,CAAC,EAAD,CANd,yCAMjByB,OANiB,eAMRC,UANQ,8BAOC1B,QAAQ,CAAC,EAAD,CAPT,0CAOlB2B,KAPkB,gBAOXC,QAPW,gCAQO5B,QAAQ,CAAC,EAAD,CARf,2CAQlB6B,QARkB,gBAQRC,WARQ,gCASA9B,QAAQ,CAAC,IAAD,CATR,2CASjB+B,IATiB,gBASXC,OATW,gCAUJhC,QAAQ,EAVJ,2CAUjBiC,EAViB,gBAUbC,KAVa,gCAWQlC,QAAQ,CAAC,IAAD,CAXhB,2CAWjBmC,QAXiB,gBAWPC,WAXO,gCAYqBpC,QAAQ,CAAC,EAAD,CAZ7B,2CAYlBqC,eAZkB,gBAYDC,kBAZC,gBAazB,GAAMC,CAAAA,OAAO,CAAG7B,SAAS,EAAzB,CACA,GAAM8B,CAAAA,OAAO,CAAGlC,UAAU,EAA1B,CACC,GAAMmC,CAAAA,KAAK,CAAG,CAAC,WAAD,CAAc,YAAd,CAA4B,WAA5B,CAAd,CAEA1C,SAAS,CAAC,UAAM,CACjBE,EAAE,CAACyC,UAAH,CAAc,OAAd,EAAuBC,KAAvB,CAA6B,OAA7B,CAAsC,IAAtC,CAA4C3B,WAAW,CAACW,KAAxD,EAAgEiB,GAAhE,GAAsEC,IAAtE,CAA2E,SAAAC,QAAQ,CAAI,CACrF,GAAMC,CAAAA,WAAW,CAAG5C,cAAc,CAAC2C,QAAD,CAAlC,CACAxB,UAAU,CAACyB,WAAW,CAAC,CAAD,CAAZ,CAAV,CACAb,KAAK,CAACa,WAAW,CAAC,CAAD,CAAX,CAAed,EAAhB,CAAL,CAED,CALD,EAMD,CAPW,CAAT,CASD,GAAMe,CAAAA,YAAY,CAAG,QAAfA,CAAAA,YAAe,CAACC,CAAD,CAAO,CACxB,GAAIC,CAAAA,YAAY,CAAGD,CAAC,CAACE,MAAF,CAASC,KAAT,CAAe,CAAf,CAAnB,CAEA,GAAIF,YAAJ,CAAkB,CACd,GAAIT,KAAK,CAACY,QAAN,CAAeH,YAAY,CAACI,IAA5B,CAAJ,CAAuC,CAEnClC,QAAQ,CAAC,IAAD,CAAR,CACAY,OAAO,CAACkB,YAAD,CAAP,CAEH,CALD,IAKO,CACHlB,OAAO,CAAC,IAAD,CAAP,CACAZ,QAAQ,CAAC,0CAAD,CAAR,CACAgB,WAAW,CAAC,IAAD,CAAX,CACH,CACJ,CAGJ,CAjBD,CA1ByB,gBA6CE5B,UAAU,CAACuB,IAAD,CA7CZ,CA6ChBwB,QA7CgB,aA6ChBA,QA7CgB,CA6CNC,GA7CM,aA6CNA,GA7CM,iBA8CDxD,QAAQ,CAACwD,GAAD,CA9CP,2CA8ClBC,IA9CkB,gBA8CZC,OA9CY,wBAiDbC,CAAAA,YAjDa,gJAiD5B,iBAA4BV,CAA5B,kHACOA,CAAC,CAACW,cAAF,GADP,KAEO/B,QAAQ,GAAKQ,eAFpB,0DAGYjB,QAAQ,CAAC,0CAAD,CAHpB,cAOSS,QAAQ,CAACgC,MAAT,CAAkB,CAP3B,0DASYzC,QAAQ,CAAC,kDAAD,CATpB,SAYG,GAAIO,KAAK,GAAKX,WAAW,CAACW,KAA1B,CAAiC,CAChCT,WAAW,CAACS,KAAD,CAAX,CAEA,CACDH,UAAU,CAAC,IAAD,CAAV,CACAJ,QAAQ,CAAC,EAAD,CAAR,CACCnB,EAAE,CAACyC,UAAH,CAAc,OAAd,EAAuBoB,GAAvB,CAA2B7B,EAA3B,EAA+B8B,MAA/B,CAAsC,CAAClC,QAAQ,CAARA,QAAD,CAAtC,EAlBJ,uCAqBYZ,CAAAA,cAAc,CAACY,QAAD,CArB1B,SAsBWH,UAAU,CAAC,iCAAD,CAAV,CAtBX,iFAwBON,QAAQ,CAAC,6CAAD,CAAR,CAxBP,qEAjD4B,+CA+E3B,GAAM4C,CAAAA,YAAY,CAAG,QAAfA,CAAAA,YAAe,EAAM,CACxB,GAAMC,CAAAA,OAAO,CAAG,CAACT,GAAG,CAAHA,GAAD,CAAhB,CACGvD,EAAE,CAACyC,UAAH,CAAc,OAAd,EAAuBoB,GAAvB,CAA2B7B,EAA3B,EAA+B8B,MAA/B,CAAsCE,OAAtC,EAA+CpB,IAA/C,CAAoD,SAAAqB,IAAI,CAAI,CAC9DC,OAAO,CAACC,GAAR,CAAYF,IAAZ,EACD,CAFG,EAGL,CALD,CAOE,mBACE,KAAC,IAAD,EAAM,KAAK,CAAC,kBAAZ,uBACI,MAAC,SAAD,EAAW,QAAQ,CAAE,KAArB,CAA4B,KAAK,CAAE,CAACG,SAAS,CAAE,IAAZ,CAAkBC,YAAY,CAAE,IAAhC,CAAnC,wBACE,aAAK,KAAK,CAAE,CAACC,OAAO,CAAE,MAAV,CAAkBC,cAAc,CAAE,QAAlC,CAAZ,WACCrD,KAAK,eAAI,KAAC,KAAD,EAAO,QAAQ,CAAC,OAAhB,UAAyBA,KAAzB,EADV,CAECM,OAAO,eAAI,KAAC,KAAD,EAAO,QAAQ,CAAC,SAAhB,UAA2BA,OAA3B,EAFZ,GADF,cAKC,aAAK,KAAK,CAAE,CAAC8C,OAAO,CAAE,MAAV,CAAkBC,cAAc,CAAE,eAAlC,CAAZ,wBACO,oCACI,KAAC,UAAD,EAAY,OAAO,CAAC,IAApB,uBAAyB,sCAAzB,EADJ,cAEJ,KAAC,UAAD,EAAY,OAAO,CAAC,IAApB,sCAFI,GADP,cAKO,aALP,GALD,cAaA,aAbA,cAcE,MAAC,IAAD,EACA,SAAS,KADT,CAEA,OAAO,CAAE,CAFT,wBAIC,MAAC,IAAD,EACH,IAAI,KADD,CAED,EAAE,CAAE,CAFH,CAGD,EAAE,CAAE,EAHH,CAID,EAAE,CAAE,CAJH,CAKD,EAAE,CAAE,EALH,wBAQP,MAAC,IAAD,yBACA,KAAC,WAAD,wBACE,MAAC,GAAD,EACE,UAAU,CAAC,QADb,CAEE,OAAO,CAAC,MAFV,CAGE,aAAa,CAAC,QAHhB,wBAKE,KAAC,MAAD,EACE,SAAS,CAAEjC,OAAO,CAAC3B,MADrB,CAEE,GAAG,CAAES,OAAO,CAACmC,GAFf,EALF,cASE,KAAC,UAAD,EACE,KAAK,CAAC,aADR,CAEE,YAAY,KAFd,CAGE,OAAO,CAAC,IAHV,qBAKMnC,OAAO,CAACoD,SALd,aAK2BpD,OAAO,CAACqD,QALnC,GATF,cAgBE,KAAC,UAAD,EACE,KAAK,CAAC,eADR,CAEE,OAAO,CAAC,OAFV,UAIGrD,OAAO,CAACsD,IAJX,EAhBF,GADF,EADA,cA4BA,KAAC,OAAD,IA5BA,cA6BC,MAAC,WAAD,EAAa,KAAK,CAAE,CAACJ,OAAO,CAAE,MAAV,CAAkBC,cAAc,CAAE,cAAlC,CAApB,wBAEA,cAAO,IAAI,CAAC,MAAZ,CAAoB,QAAQ,CAAExB,YAA9B,EAFA,cAGA,KAAC,MAAD,EAAQ,QAAQ,CAAEO,QAAQ,CAAG,GAA7B,CAAmC,OAAO,CAAC,UAA3C,CAAsD,KAAK,CAAC,SAA5D,CAAsE,OAAO,CAAES,YAA/E,oBAHA,GA7BD,GARO,cA2CT,KAAC,IAAD,WACGjC,IAAI,eAAI,qBAAIwB,QAAJ,gBADX,EA3CS,GAJD,cAuDR,KAAC,IAAD,EACE,IAAI,KADN,CAEE,EAAE,CAAE,CAFN,CAGE,EAAE,CAAE,EAHN,CAIE,EAAE,CAAE,CAJN,CAKE,EAAE,CAAE,EALN,uBAOM,aAAM,SAAS,CAAEhB,OAAO,CAAC5B,IAAzB,CAA+B,QAAQ,CAAEgD,YAAzC,uBACL,MAAC,IAAD,yBACG,KAAC,UAAD,EACE,SAAS,CAAC,+BADZ,CAEE,KAAK,CAAC,SAFR,EADH,cAMG,KAAC,OAAD,IANH,cAOG,MAAC,WAAD,yBACM,KAAC,SAAD,EACE,SAAS,KADX,CAEE,KAAK,CAAC,eAFR,CAGE,IAAI,CAAC,OAHP,CAIE,QAAQ,KAJV,CAKE,KAAK,CAAE3C,WAAW,CAACW,KALrB,CAME,OAAO,CAAC,UANV,CAOE,KAAK,CAAE,CAAC2C,YAAY,CAAE,IAAf,CAPT,CAQE,QAAQ,CAAE,kBAACrB,CAAD,QAAOrB,CAAAA,QAAQ,CAACqB,CAAC,CAACE,MAAF,CAASyB,KAAV,CAAf,EARZ,EADN,cAYM,KAAC,SAAD,EACE,SAAS,KADX,CAEE,KAAK,CAAC,UAFR,CAGE,UAAU,CAAC,wCAHb,CAIE,KAAK,CAAE/C,QAJT,CAKE,QAAQ,KALV,CAME,IAAI,CAAC,UANP,CAOE,OAAO,CAAC,UAPV,CAQG,KAAK,CAAE,CAACyC,YAAY,CAAE,IAAf,CARV,CASE,QAAQ,CAAE,kBAACrB,CAAD,QAAOnB,CAAAA,WAAW,CAACmB,CAAC,CAACE,MAAF,CAASyB,KAAV,CAAlB,EATZ,EAZN,cAwBM,KAAC,SAAD,EACE,SAAS,KADX,CAEE,KAAK,CAAC,mBAFR,CAGE,KAAK,CAAEvC,eAHT,CAIE,IAAI,CAAC,UAJP,CAKE,QAAQ,KALV,CAME,KAAK,CAAE,CAACiC,YAAY,CAAE,IAAf,CANT,CAOE,OAAO,CAAC,UAPV,CAQE,QAAQ,CAAE,kBAACrB,CAAD,QAAOX,CAAAA,kBAAkB,CAACW,CAAC,CAACE,MAAF,CAASyB,KAAV,CAAzB,EARZ,EAxBN,GAPH,cA8CG,KAAC,OAAD,IA9CH,cA+CG,MAAC,GAAD,EACE,OAAO,CAAC,MADV,CAEE,cAAc,CAAC,UAFjB,CAGE,CAAC,CAAE,CAHL,wBAKE,KAAC,MAAD,EACA,IAAI,CAAC,QADL,CAEA,KAAK,CAAE,CAACC,eAAe,CAAE,8EAAlB,CAAkGC,KAAK,CAAE,OAAzG,CAFP,CAGA,OAAO,CAAC,WAHR,CAIA,OAAO,CAAEnB,YAJT,0BALF,cAcG,KAAC,MAAD,EACH,KAAK,CAAE,CAACkB,eAAe,CAAE,6EAAlB,CAAiG/D,KAAK,CAAE,OAAxG,CAAiHiE,UAAU,CAAE,IAA7H,CADJ,CAED,KAAK,CAAC,WAFL,CAGD,OAAO,CAAC,WAHP,CAID,IAAI,CAAC,GAJJ,oBAdH,GA/CH,GADK,EAPN,EAvDQ,GAdF,GADJ,EADF,CAiKH,CAvPD,CAyPA,cAAehE,CAAAA,cAAf","sourcesContent":["import {\r\n  Box,\r\n  Button,\r\n  Card,\r\n  CardContent,\r\n  CardHeader,\r\n  Divider,\r\n  Grid,\r\n  TextField,\r\n  makeStyles,\r\n  Container,\r\n  Typography,\r\n  CardActions,\r\n  Avatar,\r\n  InputLabel\r\n} from '@material-ui/core';\r\nimport React, { useEffect, useState } from 'react'\r\nimport { db, storageRef } from '../../firebase'\r\nimport { firebaseLooper } from '../../utils/tools'\r\nimport { useAuth } from '../context/AuthContext'\r\nimport { Link, useHistory } from \"react-router-dom\"\r\nimport { Alert } from '@material-ui/lab';\r\nimport { useStorage } from '../../utils/useStorage';\r\nimport Page from '../Page';\r\n\r\nconst useStyles = makeStyles(() => ({\r\n  root: {\r\n     \r\n      \r\n  },\r\n  avatar: {\r\n    height: 100,\r\n    width: 100\r\n  }\r\n}));\r\n\r\nconst AccountDetails = () => {\r\n\r\n   const { currentUser, updatePassword, updateEmail } = useAuth()\r\n  const [error, setError] = useState(\"\")\r\n    const [account, setAccount] = useState([])\r\n     const [loading, setLoading] = useState(false)\r\n     const [message, setMessage] = useState(\"\")\r\n    const [email, setEmail] = useState(\"\")\r\n    const [password, setPassword] = useState(\"\")\r\n     const [file, setFile] = useState(null);\r\n     const [id, setId] = useState()\r\n     const [disabled, setDisabled] = useState(true)\r\n    const [passwordConfirm, setPasswordConfirm] = useState(\"\")\r\n    const classes = useStyles();\r\n    const history = useHistory()\r\n     const types = [\"image/png\", \"image/jpeg\", \"image/jpg\"];\r\n\r\n     useEffect(() => {\r\n    db.collection('users').where('email', '==', currentUser.email ).get().then(snapshot => {\r\n      const accountData = firebaseLooper(snapshot)\r\n      setAccount(accountData[0])\r\n      setId(accountData[0].id)\r\n      \r\n    })\r\n  })\r\n\r\n    const handleChange = (e) => {\r\n        let selectedFile = e.target.files[0];\r\n       \r\n        if (selectedFile) {\r\n            if (types.includes(selectedFile.type)) {\r\n                \r\n                setError(null);\r\n                setFile(selectedFile);\r\n                \r\n            } else {\r\n                setFile(null);\r\n                setError(\"Please select an image file (png or jpg)\");\r\n                setDisabled(true)\r\n            }\r\n        }\r\n       \r\n        \r\n    }\r\n\r\n     const { progress, url } = useStorage(file);\r\n    const [link, setLink] = useState(url)\r\n  \r\n\r\n async function handleSubmit(e) {\r\n        e.preventDefault()\r\n    if (password !== passwordConfirm) {\r\n      return setError(\"Passwords do not match! Please try again\")\r\n    }\r\n\r\n\r\n      if (password.length < 6){\r\n     \r\n      return setError(\"Weak Password ! Passwords should be 6 characters\")\r\n    }\r\n\r\n    if (email !== currentUser.email) {\r\n     updateEmail(email)\r\n    \r\n    }\r\n    setLoading(true)\r\n    setError(\"\")\r\n     db.collection('users').doc(id).update({password})\r\n    \r\n    try {\r\n      await  updatePassword(password)\r\n            setMessage(\"Password updated successfully !\")\r\n    } catch (error) {\r\n        setError(\"Failed to Update Password! Please try again\")\r\n    }\r\n\r\n    \r\n  }\r\n   \r\n  const handleUpload = () => {\r\n     const reqData = {url}\r\n        db.collection('users').doc(id).update(reqData).then(data => {\r\n      console.log(data)\r\n    })\r\n  }\r\n \r\n    return (\r\n      <Page title='Account | LyoIms'>\r\n          <Container maxWidth={false} style={{marginTop: '3%', marginBottom: '3%'}}>\r\n            <div style={{display: 'flex', justifyContent: 'center'}}>\r\n            {error && <Alert severity=\"error\">{error}</Alert>}\r\n            {message && <Alert severity=\"success\">{message}</Alert>}\r\n            </div>\r\n           <div style={{display: 'flex', justifyContent: 'space-between'}}>\r\n                  <div>\r\n                      <Typography variant='h1'><b>Account Details</b></Typography>\r\n              <Typography variant='h5'>Edit the data you want! </Typography>\r\n                  </div>\r\n                  <hr/>\r\n                 \r\n         </div>\r\n          <br/>\r\n            <Grid\r\n            container\r\n            spacing={3}\r\n            >\r\n             <Grid\r\n          item\r\n            lg={6}\r\n            sm={12}\r\n            xl={3}\r\n            xs={12}\r\n           >\r\n             \r\n      <Card >\r\n      <CardContent>\r\n        <Box\r\n          alignItems=\"center\"\r\n          display=\"flex\"\r\n          flexDirection=\"column\"\r\n        >\r\n          <Avatar\r\n            className={classes.avatar}\r\n            src={account.url}\r\n          />\r\n          <Typography\r\n            color=\"textPrimary\"\r\n            gutterBottom\r\n            variant=\"h3\"\r\n          >\r\n           {` ${account.firstName} ${account.lastName}`}\r\n          </Typography>\r\n          <Typography\r\n            color=\"textSecondary\"\r\n            variant=\"body1\"\r\n          >\r\n            {account.role}\r\n          </Typography>\r\n         \r\n        </Box>\r\n        \r\n      </CardContent>\r\n      <Divider />\r\n       <CardActions style={{display: 'flex', justifyContent: 'space-evenly'}}>\r\n     \r\n       <input type=\"file\"  onChange={handleChange} />\r\n       <Button disabled={progress < 100}  variant=\"outlined\" color=\"primary\" onClick={handleUpload} >Upload</Button>\r\n      </CardActions>\r\n    </Card>\r\n    <Grid>\r\n      {file && <p>{progress}% uploaded</p>}\r\n    </Grid>\r\n    </Grid>\r\n\r\n    \r\n    \r\n    {/* Details */}\r\n    <Grid\r\n      item\r\n      lg={6}\r\n      sm={12}\r\n      xl={3}\r\n      xs={12}\r\n    >\r\n          <form className={classes.root} onSubmit={handleSubmit}>\r\n     <Card>\r\n        <CardHeader\r\n          subheader=\"The information can be edited\"\r\n          title=\"Profile\"\r\n        />\r\n        \r\n        <Divider />\r\n        <CardContent>\r\n              <TextField\r\n                fullWidth\r\n                label=\"Email Address\"\r\n                name=\"email\"\r\n                required\r\n                value={currentUser.email}\r\n                variant=\"outlined\"\r\n                style={{marginBottom: \"5%\"}}\r\n                onChange={(e) => setEmail(e.target.value)}\r\n              />\r\n            \r\n              <TextField\r\n                fullWidth\r\n                label=\"Password\"\r\n                helperText=\"Create a new password for the account!\"\r\n                value={password}\r\n                required\r\n                type=\"password\"\r\n                variant=\"outlined\"\r\n                 style={{marginBottom: \"5%\"}}\r\n                onChange={(e) => setPassword(e.target.value)}\r\n              />\r\n\r\n              <TextField\r\n                fullWidth\r\n                label=\"Re-enter Password\"\r\n                value={passwordConfirm}\r\n                type=\"password\"\r\n                required\r\n                style={{marginBottom: \"5%\"}}\r\n                variant=\"outlined\"\r\n                onChange={(e) => setPasswordConfirm(e.target.value)}\r\n              />\r\n              \r\n             \r\n        \r\n\r\n        </CardContent>\r\n        <Divider />\r\n        <Box\r\n          display=\"flex\"\r\n          justifyContent=\"flex-end\"\r\n          p={2}\r\n        >\r\n          <Button\r\n          type=\"submit\"\r\n          style={{backgroundImage: 'linear-gradient(to left bottom, #420ffa, #004dff, #006eff, #238aff, #59a3ff)', color: 'white'}}\r\n          variant=\"contained\"\r\n          onClick={handleSubmit}\r\n          >\r\n            Save details\r\n          </Button>\r\n\r\n           <Button\r\n        style={{backgroundImage: ' linear-gradient(to right top, #fa0f0f, #fb3434, #f84d50, #f36268, #ea757e)' ,width: \"100px\", marginLeft: \"5%\"}}\r\n          color=\"secondary\"\r\n          variant=\"contained\"\r\n          href=\"/\"\r\n          >\r\n            Cancel\r\n          </Button>\r\n        </Box>\r\n     </Card>\r\n      </form>\r\n    </Grid>\r\n            </Grid>\r\n\r\n       \r\n\r\n        \r\n    </Container>\r\n      </Page>\r\n      \r\n    )\r\n}\r\n\r\nexport default AccountDetails\r\n"]},"metadata":{},"sourceType":"module"}