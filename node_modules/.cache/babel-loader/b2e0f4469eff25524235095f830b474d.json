{"ast":null,"code":"import _slicedToArray from\"/Users/suryanandsunil/Desktop/proto1-arizon/lyo-test/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import{Button,Container,TextField}from'@material-ui/core';import React,{useEffect,useRef,useState}from'react';import{useAuth}from'../../../components/context/AuthContext';import{db}from'../../../firebase';import{firebaseLooper}from'../../../utils/tools';import'./Chatbox.css';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var Chatbox=function Chatbox(_ref){var call_id=_ref.call_id;var _useState=useState([]),_useState2=_slicedToArray(_useState,2),chat=_useState2[0],setChat=_useState2[1];var _useAuth=useAuth(),currentUser=_useAuth.currentUser;var _useState3=useState([]),_useState4=_slicedToArray(_useState3,2),userData=_useState4[0],setUserData=_useState4[1];var _useState5=useState(''),_useState6=_slicedToArray(_useState5,2),message=_useState6[0],setMessage=_useState6[1];//  const [call_id, setCallId] = useState('')\nvar url=userData.url;var username=userData.username;var email=userData.email;var index=chat.length;var messageEl=useRef(null);useEffect(function(){if(messageEl){messageEl.current.addEventListener('DOMNodeInserted',function(event){var target=event.currentTarget;target.scroll({top:target.scrollHeight,behavior:'smooth'});});}db.collection('users').where('email','==',\"\".concat(currentUser.email)).onSnapshot(function(doc){var data=firebaseLooper(doc);setUserData(data[0]);});db.collection('CallMessages').onSnapshot(function(doc){var data=firebaseLooper(doc);data.sort(function(a,b){return a.index-b.index;});setChat(data);console.log(data);});},[]);var getReply=function getReply(username,email,message,url,callId){if(callId===call_id){if(email!=currentUser.email){return/*#__PURE__*/_jsx(\"div\",{class:\"chat-message\",children:/*#__PURE__*/_jsxs(\"div\",{class:\"flex m-2 items-end\",children:[/*#__PURE__*/_jsx(\"img\",{class:\"w-6 h-6 rounded-full order-2\",src:url}),/*#__PURE__*/_jsx(\"div\",{class:\"flex flex-col space-y-2 text-xs max-w-xs mx-2 order-2 items-start\",children:/*#__PURE__*/_jsx(\"div\",{children:/*#__PURE__*/_jsx(\"span\",{class:\"px-4 py-2 rounded-lg inline-block rounded-bl-none bg-gray-300 text-gray-600\",children:message})})})]})});}else if(email===currentUser.email){return/*#__PURE__*/_jsx(\"div\",{class:\"chat-message\",children:/*#__PURE__*/_jsxs(\"div\",{class:\"flex m-2 items-end justify-end\",children:[/*#__PURE__*/_jsx(\"div\",{class:\"flex flex-col space-y-2 text-xs max-w-xs mx-2 order-1 items-end\",children:/*#__PURE__*/_jsx(\"div\",{children:/*#__PURE__*/_jsx(\"span\",{class:\"px-4 py-2 rounded-lg inline-block rounded-br-none bg-yellow-900 text-white \",children:message})})}),/*#__PURE__*/_jsx(\"img\",{src:url,alt:\"My profile\",class:\"w-6 h-6 rounded-full order-2\"})]})});}}};function handleKeyDown(e){if(e.key==='Enter'){handleSubmit(e);}}var handleSubmit=function handleSubmit(e){e.preventDefault();if(message.length===0||message.trim().length===0)return;var messageData={url:url,username:username,email:email,message:message,index:index};db.collection('CallMessages').add({url:url,username:username,email:email,message:message,index:index,call_id:call_id});setMessage('');};return/*#__PURE__*/_jsx(Container,{style:{backgroundColor:'white',border:'2px solid gray',height:'100vh'},children:/*#__PURE__*/_jsxs(\"div\",{className:\"chat\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"chat__header\",children:/*#__PURE__*/_jsx(\"h1\",{children:\"ChatBox\"})}),/*#__PURE__*/_jsx(\"div\",{className:\"chat__body\",ref:messageEl,children:chat.filter(function(message){if(message.call_id==call_id){return message;}}).map(function(message){return/*#__PURE__*/_jsx(\"p\",{className:\"chat__message \".concat(message.email===currentUser.email&&\"chat__receiver\"),children:/*#__PURE__*/_jsxs(\"div\",{class:\"flex m-2 items-end justify-end\",children:[/*#__PURE__*/_jsx(\"div\",{class:\"flex flex-col space-y-2 text-xs max-w-xs mx-2 order-1 items-end\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"mx-auto \",children:[/*#__PURE__*/_jsx(\"span\",{className:\"chat__name\",children:message.username}),/*#__PURE__*/_jsx(\"span\",{className:\"chat__messageText\",children:message.message}),\" \"]})}),/*#__PURE__*/_jsx(\"img\",{src:message.url,alt:\"My profile\",class:\"w-6 h-6 rounded-full order-2\"})]})});})}),/*#__PURE__*/_jsxs(\"div\",{className:\"chat__footer\",children:[/*#__PURE__*/_jsx(TextField,{fullWidth:true,multiLine:true,variant:\"outlined\",type:\"text\",value:message,id:\"chatInput\",onKeyPress:handleKeyDown,onChange:function onChange(e){return setMessage(e.target.value);},placeholder:\"Type a message\"}),/*#__PURE__*/_jsx(Button,{type:\"submit\",onClick:handleSubmit,children:\"Send\"})]})]})});};export default Chatbox;","map":{"version":3,"sources":["/Users/suryanandsunil/Desktop/proto1-arizon/lyo-test/src/Pages/VideoCallPage/components/Chatbox.jsx"],"names":["Button","Container","TextField","React","useEffect","useRef","useState","useAuth","db","firebaseLooper","Chatbox","call_id","chat","setChat","currentUser","userData","setUserData","message","setMessage","url","username","email","index","length","messageEl","current","addEventListener","event","target","currentTarget","scroll","top","scrollHeight","behavior","collection","where","onSnapshot","doc","data","sort","a","b","console","log","getReply","callId","handleKeyDown","e","key","handleSubmit","preventDefault","trim","messageData","add","backgroundColor","border","height","filter","map","value"],"mappings":"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","sourcesContent":["import { Button, Container, TextField } from '@material-ui/core'\nimport React, { useEffect, useRef, useState } from 'react'\nimport { useAuth } from '../../../components/context/AuthContext'\nimport { db } from '../../../firebase'\nimport { firebaseLooper } from '../../../utils/tools'\nimport './Chatbox.css'\nconst Chatbox = ({call_id}) => {\n    const [chat, setChat] = useState([])\n    const {currentUser} = useAuth()\n    const [userData, setUserData] = useState([])\n    const [message, setMessage] = useState('')\n    //  const [call_id, setCallId] = useState('')\n    const url = userData.url\n        const username = userData.username\n        const email = userData.email\n        const index = chat.length\n        const messageEl = useRef(null);\n    useEffect(() => {\n        if (messageEl) {\n      messageEl.current.addEventListener('DOMNodeInserted', event => {\n        const { currentTarget: target } = event;\n        target.scroll({ top: target.scrollHeight, behavior: 'smooth' });\n      });\n    }\n        db.collection('users').where('email','==', `${currentUser.email}`).onSnapshot(doc => {\n            const data = firebaseLooper(doc)\n            setUserData(data[0])\n        })\n        db.collection('CallMessages').onSnapshot(doc => {\n            const data = firebaseLooper(doc)\n            data.sort(function(a,b){\n                return(a.index-b.index)\n            })\n            setChat(data)\n            console.log(data)\n        })\n    }, [])\n    const  getReply = (username,email,message,url,callId) => {\n        if(callId === call_id){\n            if(email != currentUser.email){\n            return(\n                <div class=\"chat-message\">\n                    <div class=\"flex m-2 items-end\">\n                         <img  class=\"w-6 h-6 rounded-full order-2\" src={url}/>\n                        <div class=\"flex flex-col space-y-2 text-xs max-w-xs mx-2 order-2 items-start\">\n                            \n                        <div><span class=\"px-4 py-2 rounded-lg inline-block rounded-bl-none bg-gray-300 text-gray-600\">{message}</span></div>\n                        </div>\n                       \n                    </div>\n                </div>\n            )\n        }else if (email === currentUser.email){\n             return(\n                 <div class=\"chat-message\">\n         <div  class=\"flex m-2 items-end justify-end\">\n            <div class=\"flex flex-col space-y-2 text-xs max-w-xs mx-2 order-1 items-end\">\n               <div><span class=\"px-4 py-2 rounded-lg inline-block rounded-br-none bg-yellow-900 text-white \">{message}</span></div>\n            </div>\n            <img src={url} alt=\"My profile\" class=\"w-6 h-6 rounded-full order-2\"/>\n         </div>\n      </div>\n             ) \n        }\n        }\n        \n    }\n\n     function handleKeyDown(e) {\n    if (e.key === 'Enter') {\n      handleSubmit(e)\n    }\n  }\n   \n    const handleSubmit = (e) => {\n        e.preventDefault()\n        if (message.length === 0 || message.trim().length === 0) return;\n        const messageData = {url,username,email,message,index}\n        db.collection('CallMessages').add({url,username,email,message,index,call_id})\n        setMessage('')\n    }\n    \n    return (\n \n        <Container style={{backgroundColor: 'white', border: '2px solid gray',height: '100vh'}}>\n          <div className=\"chat\">\n              <div className=\"chat__header\">\n                  <h1>ChatBox</h1>\n              </div>\n              <div className=\"chat__body\" ref={messageEl}>\n        {chat.filter((message) =>{\n            if(message.call_id == call_id){\n                return message\n            }\n        }\n\n        ).map((message) => (\n          <p\n            className={`chat__message ${\n              message.email === currentUser.email && \"chat__receiver\"\n            }`}\n          > \n          <div  class=\"flex m-2 items-end justify-end\">\n             \n           <div class=\"flex flex-col space-y-2 text-xs max-w-xs mx-2 order-1 items-end\">\n\n               <div className='mx-auto '>\n                    <span className=\"chat__name\">{message.username}</span>\n                   <span className=\"chat__messageText\">{message.message}</span> </div>\n            </div>\n           \n            <img src={message.url} alt=\"My profile\" class=\"w-6 h-6 rounded-full order-2\"/>\n          </div>\n          \n            \n          </p>\n        ))} \n\n        \n        </div>\n         <div className=\"chat__footer\" >\n            \n                  <TextField\n               fullWidth\n               multiLine\n               variant='outlined'\n            type=\"text\"\n            value={message}\n            id=\"chatInput\"\n            onKeyPress={handleKeyDown}\n            onChange={(e) => setMessage(e.target.value)}\n            placeholder=\"Type a message\"\n          />\n          <Button type=\"submit\" onClick={handleSubmit}>\n            Send\n          </Button>\n         </div>\n          </div>\n        </Container> \n    )\n}\n\nexport default Chatbox\n"]},"metadata":{},"sourceType":"module"}